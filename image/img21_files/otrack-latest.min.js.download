!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).OTrack=t()}(this,(function(){"use strict";function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function t(t){for(var n=1;arguments.length>n;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?e(Object(r),!0).forEach((function(e){a(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;t.length>n;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}function u(e,t){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},u(e,t)}function l(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;o.length>r;r++)0>t.indexOf(n=o[r])&&(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;o.length>r;r++)0>t.indexOf(n=o[r])&&Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return f(e)}function p(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=c(e);if(t){var i=c(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return d(this,n)}}function v(e,t){return g(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(e){s=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}(e,t)||y(e,t)||w()}function h(e){return function(e){if(Array.isArray(e))return _(e)}(e)||m(e)||y(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(e){if(Array.isArray(e))return e}function m(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function y(e,t){if(e){if("string"==typeof e)return _(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_(e,t):void 0}}function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);t>n;n++)r[n]=e[n];return r}function w(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var k,b,T,E={app_id:"",app_key:"",env:"prod",region:"sg",region_code:"",session_cutting_time:30,sdk_auto_track:!0,is_single_page_app:!0,is_track_visittime:!0,log_level:"info",reported_platforms:["web"],pageview:{delay:100,track_pageview_type:"auto",track_ignore:function(){return!1},is_trigger_pageload:!0,watch_utm:!0,url_alias:{}},exposure:{once:!0,duration_threshold:300,intersection_threshold:1,root_margin:"0px"},develop:{catch_js_error:!1,performance:!1,errorRatio:.2,errorSplit:500},app_version:"",is_cross_subdomain:!1,is_print_header:!1,event_rule:[],event_blacklist:[],project:"default",quarantine_report:!1},S={balance:!0,flush:!0,is_print_header:!1,interval_time:1,max_batch_events:10,max_request_queue:10,fail_timeout:5,fail_retry_count:1};!function(e){e[e.INIT=0]="INIT",e[e.FETCH_CONFIG=1]="FETCH_CONFIG",e[e.READY=2]="READY"}(k||(k={})),function(e){e.TRACK="track",e.DEFERRED="deferred",e.REQUEST="request",e.TRACK_PENDING="track-pending"}(b||(b={})),function(e){e.BALANCE="balance",e.BALANCE_REQ="balance_req"}(T||(T={}));var I,C=[b.TRACK],O={eventId:"$page_view",eventGroup:"$track_page_view"},A={eventId:"$page_duration",eventGroup:"$track_page_view"},x={eventId:"$page_load",eventGroup:"$track_page_load"},D={eventId:"$catch_error",eventGroup:"$track_develop"},$={eventId:"$track_version",eventGroup:"$track_develop"},L={clickId:"$web_click",stayId:"$web_stay",eventGroup:"$track_heatmap"},P={eventId:"$",eventGroup:"$track_sensors"};!function(e){e.DOMESTIC="https://static-common.heytapdownload.com",e.FOREIGN="https://static-common.heytapdl.com",e.INTRANET="https://static-common.oppoer.me",e.FILES_COMMON="common-files"}(I||(I={}));var j={utm:["utm_source","utm_medium","utm_campaign","utm_content","utm_term"],search:["www.baidu.","m.baidu.","m.sm.cn","so.com","sogou.com","youdao.com","google.","yahoo.com/","bing.com/","ask.com/"],social:["weibo.com","renren.com","kaixin001.com","douban.com","qzone.qq.com","zhihu.com","tieba.baidu.com","weixin.qq.com"],keyword:{baidu:["wd","word","kw","keyword"],google:["q"],bing:["q"],yahoo:["p"],sogou:["query","keyword"],so:["q"],sm:["q"]}},N=function(e,t){var n={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};for(var r in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))),n)RegExp("("+r+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?n[r]:("00"+n[r]).substr((""+n[r]).length)));return t},R=Object.prototype.toString,U=function(e){return null!=e&&"[object Object]"==R.call(e)},M=function(e){return"[object Date]"==R.call(e)},q=function(e){return Array.isArray&&Array.isArray(e)||"[object Array]"===R.call(e)},H=function(e){return"[object Function]"==R.call(e)},F=function(e){return R.call(e).slice(8,-1)},G={addEvent:function(e,t,n){e&&(e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n)},removeEvent:function(e,t,n){e&&(e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent?e.detachEvent("on"+t,n):e["on"+t]=null)}};function V(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function W(e){for(var t=1;arguments.length>t;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?V(Object(n),!0).forEach((function(t){J(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):V(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Q(e){return Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Q(e)}function B(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function K(e,t){for(var n=0;t.length>n;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function z(e,t,n){return t&&K(e.prototype,t),n&&K(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function J(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function X(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;o.length>r;r++)0>t.indexOf(n=o[r])&&(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;o.length>r;r++)0>t.indexOf(n=o[r])&&Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function Y(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(e){s=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}(e,t)||ee(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Z(e){return function(e){if(Array.isArray(e))return te(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||ee(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ee(e,t){if(e){if("string"==typeof e)return te(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?te(e,t):void 0}}function te(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);t>n;n++)r[n]=e[n];return r}var ne=!0,re="info",ie={debug:0,info:10,warn:100,error:1e3};function oe(e){try{return JSON.stringify(e,null,"  ")}catch(t){return ge(e)}}var ae=function(e){return["string","number","boolean","undefined","null"].indexOf(Q(e))>-1},se=function(){function e(t){B(this,e),this.namespace="",this.isShowMills=!1,this.isShowLog=!0,this.info=this.genLog("info"),this.warn=this.genLog("warn"),this.error=this.genLog("error"),this.debug=this.genLog("debug"),t&&this.setLogConfig(t)}return z(e,[{key:"setLogConfig",value:function(e){var t=e.isShowLog,n=e.isShowMills,r=void 0!==n&&n,i=e.namespace,o=void 0===i?"":i;this.isShowLog=void 0===t||t,this.isShowMills=r,this.namespace=o}},{key:"config",get:function(){return{namespace:this.namespace,isShowMills:this.isShowMills,isShowLog:this.isShowLog}}},{key:"clone",value:function(t){return new e(W(W({},this.config),t))}},{key:"genLog",value:function(e){var t=this;return function(){var n="__otrack_debug",r=!1;try{var i;r=JSON.parse((null===(i=localStorage)||void 0===i?void 0:i.getItem(n))||"false")}catch(e){}if(r&&(ne=!0),!(ne&&t.isShowLog||-1!==["warn","error"].indexOf(e)))return!1;if(ie[re]>ie[e])return!1;for(var o=arguments.length,a=Array(o),s=0;o>s;s++)a[s]=arguments[s];var c=a.map((function(e,t,n){return U(e)?oe(e):q(e)?e.every((function(e){return ae(e)||q(e)}))?e:oe(e):ae(e)&&t!==n.length-1?e+"":e})),u=new Date;""!==t.namespace&&c.unshift(t.namespace),c.unshift("".concat(N(u,"yyyy-MM-dd hh:mm:ss"+(t.isShowMills?".S":""))));var l=c.filter((function(e){return""!==e}));if("object"===(void 0===console?"undefined":Q(console))&&console[e])try{return console[e].call(console,l.join(", "))}catch(t){console[e](l[0])}}}}]),e}();se.disableAllLog=function(){ne=!1,se.disableAllLog=function(){}},se.setLogLevel=function(e){["info","debug","error","warn"].includes(e)&&(re=e)};var ce=new se,ue="0123456789",le="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",fe="~!@#$%^*()_+-=[]{}|;:,./<>?";
/**
   * @copyright Maichong Software Ltd. 2016 http://maichong.it
   * @date 2016-01-20
   * @author Liang <liang@maichong.it>
   */function de(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{specials:!1,letters:!0,numbers:!0};e||(e=8),t||(t={});var n="",r="";for(!0===t?n=ue+le+fe:"string"==typeof t?n=t:(!1!==t.numbers&&(n+="string"==typeof t.numbers?t.numbers:ue),!1!==t.letters&&(n+="string"==typeof t.letters?t.letters:le),t.specials&&(n+="string"==typeof t.specials?t.specials:fe));e>0;)e--,r+=n[Math.floor(Math.random()*n.length)];return r}var pe=de(8);function ve(e){for(var t={},n=[],r=0;e.length>r;r++){var i=e[r];t.hasOwnProperty(i)?t[i]=!0:(t[i]=!1,n.push(e[r]))}return n}function he(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={};return e.filter(Boolean).forEach((function(e){var i="function"==typeof t?t(e):t;r[e[i]]?!n&&r[e[i]].push(e):r[e[i]]=n?e:[e]})),r}function ge(e,t,n,r,i){t=void 0!==t?isNaN(+t)?6:t:6;var o=new WeakMap;return JSON.stringify(function e(t,r,a,s,c){return t&&"object"==Q(t)?(c=o.has(t),o.set(t,!0),s=Array.isArray(t),c?a=i&&i(t)||null:JSON.stringify(t,(function(i,o){if(s||r>0){if(n&&(o=n(i,o)),!i)return s=Array.isArray(o),t=o;!a&&(a=s?[]:{}),a[i]=e(o,s?r:r-1)}})),void 0===a?s?[]:{}:a):t}(e,t),null,r)}function me(e){if(null==e)return e;try{e=JSON.parse(e)}catch(e){}return e}function ye(e,t,n,r){r=W({cross_subdomain:!1,domain:""},r);var i=new Date,o=0;"number"==typeof n?o=i.getTime()+24*n*60*60*1e3:M(n)&&(o=n.getTime()),i.setTime(o);var a="; expires="+i.toUTCString();0===n&&(a=""),r.cross_subdomain&&(r.domain=function(e){var t;if(!(e=e||(null===(t=location)||void 0===t?void 0:t.hostname)))return"";var n=e.split(".");if(q(n)&&n.length>=2&&!/^(\d+\.)+\d+$/.test(e))for(var r="."+n.splice(n.length-1,1);n.length>0;)if(r="."+n.splice(n.length-1,1)+r,document.cookie="otrack_jssdk_domain_test=true; path=/; domain="+r,-1!==document.cookie.indexOf("otrack_jssdk_domain_test=true")){var i=new Date;return i.setTime(i.getTime()-1e3),document.cookie="otrack_jssdk_domain_test=true; expires="+i.toUTCString()+"; path=/; domain="+r,r}return""}()),document.cookie=e+"="+t+a+"; path=/"+(r.domain?"; domain="+r.domain:"")}function _e(e){var t=[];for(var n in e)t.push(n+"="+encodeURIComponent(e[n]));return t.join("&")}function we(e){for(var t=e+"=",n=document.cookie.split(";"),r=0,i=n.length;i>r;r++){for(var o=n[r];" "===o.charAt(0);)o=o.substring(1,o.length);if(0===o.indexOf(t))return o.substring(t.length,o.length)}return null}var ke=!0;try{"undefined"!=typeof localStorage&&(localStorage.setItem("testLocal","true"),localStorage.removeItem("testLocal"))}catch(Bt){ce.warn("localStorage不支持",Bt),ke=!1}function be(e,t,n){var r,i;if(e.indexOf("-queue")>0&&(e="".concat(e,"/").concat(pe)),n=void 0===n||n,null!=t)if(t=ge(t),ke)try{var o;null===(o=localStorage)||void 0===o||o.setItem(e,t)}catch(e){if(["QUOTA_EXCEEDED_ERR","NS_ERROR_DOM_QUOTA_REACHED","QuotaExceededError","W3CException_DOM_QUOTA_EXCEEDED_ERR"].indexOf(e.name)>-1){try{for(var a=0;a<(null===(s=localStorage)||void 0===s?void 0:s.length);a++){var s,c,u=null===(c=localStorage)||void 0===c?void 0:c.key(a);if(u&&/^obus-track_/.test(u))if(-1===u.indexOf("track-queue")&&-1===u.indexOf("request-queue")){var l;null===(l=localStorage)||void 0===l||l.removeItem(u)}else{var f,d,p=(null===(f=localStorage)||void 0===f?void 0:f.getItem(u))||[];null===(d=localStorage)||void 0===d||d.setItem(u,ge({version:Date.now(),data:p.length>100?p.slice(100-p.length):p}))}}}catch(e){}return}console.log("[OTrack] setStorage error")}else n||ye(e,t,30);if(void 0===t){var v;if(ke)r=null===(v=localStorage)||void 0===v?void 0:v.getItem(e);else n||(r=we(e));return me(r)}null===t&&(ke?null===(i=localStorage)||void 0===i||i.removeItem(e):n||ye(e,"",-1))}var Te=!0;try{"undefined"!=typeof sessionStorage&&(sessionStorage.setItem("testLocal","true"),sessionStorage.removeItem("testLocal"))}catch(Bt){ce.warn("sessionStorage不支持",Bt),Te=!1}function Ee(e,t,n){var r;if(n=void 0===n||n,null!=t)if(t=ge(t),Te)try{sessionStorage.setItem(e,t)}catch(e){console.log("[OTrack] sessionStorage error")}else n||ye(e,t,30);if(void 0===t)return Te?r=sessionStorage.getItem(e):n||(r=we(e)),me(r);null===t&&(Te?sessionStorage.removeItem(e):n||ye(e,"",-1))}function Se(e){var t=(new Date).getTime(),n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===e?n:3&n|8).toString(16)}));return e&&e>0?n.slice(0,e):n}function Ie(){return Math.floor((new Date).getTime()/1e3)}function Ce(e,t){var n={};for(var r in e)e.hasOwnProperty(r)&&t(e[r],r,e)&&(n[r]=e[r]);return n}var Oe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Ae=function(e,t,n){var r,i,o,a=null,s=0;n||(n={});var c=function(){var t;s=!1===(null===(t=n)||void 0===t?void 0:t.leading)?0:Date.now(),a=null,o=e.apply(r,i),a||(r=i=null)};return function(){for(var u,l,f=arguments.length,d=Array(f),p=0;f>p;p++)d[p]=arguments[p];var v=Date.now();s||!1!==(null===(u=n)||void 0===u?void 0:u.leading)||(s=v);var h=t-(v-s);return r=this,i=arguments,0>=h||h>t?(a&&(clearTimeout(a),a=null),s=v,o=e.apply(r,i),a||(r=i=null)):a||!1===(null===(l=n)||void 0===l?void 0:l.trailing)||(a=setTimeout(c,h)),o}};function xe(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}function De(e){var t,n=null===(t=location)||void 0===t?void 0:t.search.substr(1),r={};if(n)try{n.split("&").filter(Boolean).forEach((function(e){var t=Y(e.split("="),2);r[t[0]]=decodeURIComponent(t[1])}))}catch(e){}return e?r[e]||null:r}function $e(e){if(!e)return null;var t=e.match(/^(https?:\/\/)([^\/]+)(.*)$/i);if(t){var n=Y(t,4),r=n[1],i=n[2],o=Y((n[3]||"").split("?"),2),a=o[0],s=Y((o[1]||"").split("#"),2),c=s[0],u=s[1],l=(c||"").split("&").filter(Boolean),f={};return l.forEach((function(e){var t=Y(e.split("="),2);f[t[0]]=decodeURIComponent(t[1])})),{schema:r,host:i,path:a,search:c,query:f,hash:u||""}}return null}function Le(e){var t={};return U(e)&&Object.keys(e).forEach((function(n){t[n]="function"==typeof e[n]?e[n]():e[n]})),t}var Pe,je=(Pe=(new Date).getTime(),function(e){return Math.ceil((Pe=(9301*Pe+49297)%233280)/233280*e)}),Ne=function(){if("function"==typeof Uint32Array){var e="";if("undefined"!=typeof crypto?e=crypto:"undefined"!=typeof msCrypto&&(e=msCrypto),U(e)&&e.getRandomValues){var t=new Uint32Array(1);return e.getRandomValues(t)[0]/4294967296}}return je(1e19)/1e19},Re=function(){var e=function(){for(var e=1*(new Date).getTime(),t=0;e==1*(new Date).getTime();)t++;return e.toString(16)+t.toString(16)};return function(){var t=screen.height*screen.width;t=t&&/\d{5,}/.test(t+"")?t.toString(16):(31242*Ne()+"").replace(".","").slice(0,8);var n=e()+"-"+Ne().toString(16).replace(".","")+"-"+function(){var e,t,n=navigator.userAgent,r=[],i=0;function o(e,t){var n,i=0;for(n=0;t.length>n;n++)i|=r[n]<<8*n;return e^i}for(e=0;n.length>e;e++)t=n.charCodeAt(e),r.unshift(255&t),4>r.length||(i=o(i,r),r=[]);return r.length>0&&(i=o(i,r)),i.toString(16)}()+"-"+t+"-"+e();return n||(Ne()+""+Ne()+Ne()).slice(2,15)}}();!function(){var e=Ee("LIFEID");e?pe=e:Ee("LIFEID",pe);try{for(var t=0;t<localStorage.length;t++){var n=localStorage.key(t);if(n&&/^obus-track_/.test(n)){var r=localStorage.getItem(n),i=Date.now(),o=(r=me(r)||{version:0}).version;o&&i-o>864e5&&localStorage.removeItem(n)}}}catch(e){}}();var Ue=!0;function Me(e){if(void 0===e)return Ue;Ue=e}function qe(e,t){var n,r,i=t.method,o=void 0===i?"GET":i,a=t.data,s=void 0===a?{}:a,c=t.timeout,u=void 0===c?20:c,l=!("onLine"in(navigator||{}))||(null===(n=navigator)||void 0===n?void 0:n.onLine),f=t.success,d=t.fail;u=u||20;var p=function(n){if(void 0===t.reTryCount||0>=t.reTryCount)return"function"==typeof n&&n(!0),!0;t.success=f,t.fail=d,ce.warn("retry fetch with ".concat(--t.reTryCount," count.")),qe(e,t)},v=function(){var e=window;if(void 0!==e.XMLHttpRequest)return new e.XMLHttpRequest;if(e.ActiveXObject)try{return new e.ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(e){return ce.error(e),null}}}(),h=Me();if(t.withCredentials&&(v.withCredentials=t.withCredentials),o=o.toUpperCase(),null==v)return ce.error("xhr object is null, exiting"),!1;if(!l)return ce.warn("当前网络离线，请检查网络状态!"),t.fail&&t.fail("NOT ONLINE",404),!1;if(t.success=function(e){f&&f(e),r&&(clearTimeout(r),r=0)},t.fail=function(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];p((function(e){d&&d.apply(null,t)})),r&&(clearTimeout(r),r=0)},r=window.setTimeout((function(){!function(){try{U(v)&&v.abort()}catch(e){ce.error(e)}r&&(clearTimeout(r),r=0,t.fail&&t.fail("TIMEOUT",408),v.onreadystatechange=null,v.onload=null,v.onerror=null)}()}),1e3*u),v.onreadystatechange=function(){try{4==v.readyState&&(v.status>=200&&300>v.status||304==v.status?t.success&&t.success(function(e){if(!e)return"";try{return JSON.parse(e)}catch(e){return{}}}(v.responseText)):t.fail&&t.fail(v.responseText,v.status),v.onreadystatechange=null,v.onload=null)}catch(e){console.error(e),v.onreadystatechange=null,v.onload=null}},"GET"===o.toUpperCase()){var g=function(e){if(e)for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!0;return!1}(s)?"?"+_e(s):"";v.open("GET",e+g,h)}else v.open("POST",e,h);if(U(t.headers))for(var m in t.headers)t.headers.hasOwnProperty(m)&&v.setRequestHeader&&v.setRequestHeader(m,t.headers[m]);if("GET"===o)return v.send(),!0;var y,_=t.headers&&(t.headers["Content-Type"]||t.headers["Content-type"])||"";if(0>_.indexOf("application/x-www-form-urlencoded"))0>_.indexOf("application/json")?v.send(s):v.send(JSON.stringify(s));else if((null===(y=navigator)||void 0===y?void 0:y.sendBeacon)&&!h){var w=new URLSearchParams;Object.keys(s).forEach((function(e){w.append(e,s[e])})),navigator.sendBeacon(e,w),t.success(s)}else v.send(_e(s))}var He={AT:"EU",BE:"EU",DK:"EU",FI:"EU",FR:"EU",DE:"EU",GR:"EU",IE:"EU",IT:"EU",LU:"EU",NL:"EU",PT:"EU",ES:"EU",SE:"EU",GB:"EU",HU:"EU",PL:"EU",CZ:"EU",SI:"EU",SK:"EU",EE:"EU",LT:"EU",MT:"EU",CY:"EU",RO:"EU",BG:"EU",LV:"EU",HR:"EU",NO:"EU",IS:"EU",LI:"EU",CH:"EU",TR:"EU",RS:"EU",BA:"EU",MX:"US"},Fe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";switch((e=(e||"").toUpperCase()).toUpperCase()){case"EU":case"CN":case"SG":case"IN":return e;case"SGP":case"":return"SG";case"US":return"US";default:return He[e]||"SG"}},Ge=function(){var e,t,n=null===(e=navigator)||void 0===e||null===(t=e.userAgent)||void 0===t?void 0:t.toLowerCase(),r=function(e){return e&&(n=(e+"").toLowerCase()),/(ipad|tablet|(android(?!.*mobile))|(windows(?!.*phone)(.*touch))|kindle|playbook|silk|(puffin(?!.*(IP|AP|WP))))/.test(n)?"tablet":/(mobi|ipod|phone|blackberry|opera mini|fennec|minimo|symbian|psp|nintendo ds|archos|skyfire|puffin|blazer|bolt|gobrowser|iris|maemo|semc|teashark|uzard)/.test(n)?"mobile":"desktop"};return{device:r(),detect:r,isMobile:"desktop"!==r(),userAgent:n}}();function Ve(){var e=document;return Math.max(Math.max(e.body.scrollWidth,e.documentElement.scrollWidth),Math.max(e.body.offsetWidth,e.documentElement.offsetWidth),Math.max(e.body.clientWidth,e.documentElement.clientWidth))}function We(){var e=document;return Math.min(Math.min(e.body.clientHeight,e.documentElement.clientHeight),Math.min(e.body.offsetHeight,e.documentElement.offsetHeight),window.innerHeight)}function Qe(){return window.innerWidth>window.innerHeight?"landscape":"portrait"}var Be={ucbrowser:"UC",sogou:"Sogou","2345browser":"2345",baidu:"Baidu",liebao:"LieBao",huawei:"Huawei",360:360,heytap:"oppo",oppo:"oppo",quark:"quark",vivo:"vivo",meizu:"meizu",samsung:"samsung",realme:"realme",oneplus:"oneplus",weibo:"Weibo"},Ke=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=e.match(t);return r?r[n]:"0"};var ze=function(){var e,t,n,r;if("object"!==("undefined"==typeof __wxConfig?"undefined":Q(__wxConfig))){var i=window||Object.create(null),o=(null===(e=navigator)||void 0===e||null===(t=e.userAgent)||void 0===t?void 0:t.toLowerCase())||"",a={type:"",versions:""},s={IE:i.ActiveXObject||"ActiveXObject"in i,Chrome:o.indexOf("chrome")>-1&&o.indexOf("safari")>-1,Firefox:o.indexOf("firefox")>-1,Opera:!!i.opr&&!!i.opr.addons||!!i.opera||-1!==(null===(n=navigator)||void 0===n||null===(r=n.userAgent)||void 0===r?void 0:r.indexOf("OPR/")),Safari:o.indexOf("safari")>-1&&-1==o.indexOf("chrome"),Edge:o.indexOf("edge")>-1,QQBrowser:/qqbrowser/i.test(o),WeixinBrowser:/MicroMessenger/i.test(o),QQInnerBrowser:/QQ\//i.test(o),WeiboInnerBrowser:/weibo/i.test(o)};for(var c in s)if(s[c]){var u="";if("IE"==c)u=Ke(o,/(msie\s|trident.*rv:)([\w.]+)/,2);else if("Chrome"==c){for(var l in navigator.mimeTypes)"application/360softmgrplugin"==navigator.mimeTypes[l].type&&(c="360");var f=RegExp("(".concat(Object.keys(Be).join("|"),")"),"gi"),d=o.toLowerCase().match(f);d&&(c=Be[d[0]]||"Chrome"),u=Ke(o,/chrome\/([\d.]+)/,1)}else"Firefox"==c?u=Ke(o,/firefox\/([\d.]+)/,1):"Opera"==c?u=Ke(o,/(?:opera|opr)\/([\d.]+)/,1):"Safari"==c?u=Ke(o,/version\/([\d.]+)/,1):"Edge"==c?u=Ke(o,/edge\/([\d.]+)/,1):"QQBrowser"==c?u=Ke(o,/qqbrowser\/([\d.]+)/,1):"WeixinBrowser"==c?u=Ke(o,/MicroMessenger\/([\d.]+)/,1):"QQInnerBrowser"==c?u=Ke(o,/QQ\/([\d.]+)/,1):"WeiboInnerBrowser"==c&&(u=Ke(o,/__weibo__([\d.]+)/,1));a.type=c,a.versions=parseInt(u,10)}return a}console.log("wx",__wxConfig,"__wxConfig")}(),Je=function(){var e,t,n,r,i,o,a,s,c,u,l,f,d=(null===(e=navigator)||void 0===e?void 0:e.userAgent)||"",p="Win32"==(null===(t=navigator)||void 0===t?void 0:t.platform)||"Windows"==(null===(n=navigator)||void 0===n?void 0:n.platform),v="Mac68K"==(null===(r=navigator)||void 0===r?void 0:r.platform)||"MacPPC"==(null===(i=navigator)||void 0===i?void 0:i.platform)||"Macintosh"==(null===(o=navigator)||void 0===o?void 0:o.platform)||"MacIntel"==(null===(a=navigator)||void 0===a?void 0:a.platform);if(v)return"Mac";if((null===(s=navigator)||void 0===s?void 0:s.platform)&&"iphone"==(null===(c=navigator)||void 0===c?void 0:c.platform.toLowerCase()))return"iPhone";if("X11"==(null===(u=navigator)||void 0===u?void 0:u.platform)&&!p&&!v)return"Unix";var h=((null===(l=navigator)||void 0===l?void 0:l.platform)+"").indexOf("Linux")>-1,g=null==d||null===(f=d.toLowerCase())||void 0===f?void 0:f.match(/android/i);if(h)return g?"Android":"Linux";if(p){if(d.indexOf("Windows NT 5.0")>-1||d.indexOf("Windows 2000")>-1)return"Win2000";if(d.indexOf("Windows NT 5.1")>-1||d.indexOf("Windows XP")>-1||d.indexOf("Windows XP")>-1)return"WinXP";if(d.indexOf("Windows NT 5.2")>-1||d.indexOf("Windows 2003")>-1)return"Win2003";if(d.indexOf("Windows NT 6.0")>-1||d.indexOf("Windows Vista")>-1)return"WinVista";if(d.indexOf("Windows NT 6.1")>-1||d.indexOf("Windows 7")>-1)return"Win7";if(d.indexOf("Windows NT 6.2")>-1||d.indexOf("Windows 8")>-1)return"Win8";if(d.indexOf("Windows NT 10.0")>-1||d.indexOf("Windows 10")>-1)return"Win10"}return"Others"}(),Xe=["callback"],Ye=function(){function e(t){B(this,e),this.cacheMap={},this.timeout=0,this.pendingImgs=[],this.timeout=t||3e3}return z(e,[{key:"pong",value:function(e){var t=this;if(this.cacheMap[e.key])return!1;var n=function(){t.cacheMap[e.key]&&(clearTimeout(t.cacheMap[e.key]),r.src="",delete t.cacheMap[e.key],t.pendingImgs=t.pendingImgs.filter((function(t){return t.alt!==e.key})))},r=new Image,i=e.callback||function(e,t){};r.onload=function(){i(!0,!0),n()},r.onerror=function(){i(!0,!1),n()},r.alt=e.key,this.cacheMap[e.key]=window.setTimeout((function(){i(!1,"timeout"),n()}),this.timeout),r.src=e.url+"/favicon.ico?v="+ +new Date,this.pendingImgs.push(r)}},{key:"stopLoadImgs",value:function(){this.pendingImgs.forEach((function(e){e.src=""}))}}],[{key:"racePong",value:function(t,n){var r=new e,i=t.length,o=!1,a=setTimeout((function(){o=!0,n(null)}),3e3),s=function(e,t){o||t&&(n(W(W({},e),{},{connection:t})),r.stopLoadImgs(),o=!0,clearTimeout(a)),0==--i&&(clearTimeout(a),!o&&n(null))};t.forEach((function(e){var t=X(e,Xe);r.pong(W(W({},e),{},{callback:function(e,n){s(t,!!e&&n)}}))}))}}]),e}(),Ze=function(){function e(t){B(this,e);var n=be("is_virtual_env")||"",r=Y(n.split("|"),2)[1];t&&(""===n||r&&Date.now()-+r>864e6)&&this.refreshEnv()}return z(e,[{key:"isInCloud",value:function(){var e=be("is_virtual_env");return null==e&&(e=this.isNotVirtual()?"false":"true"),"true"===e.split("|")[0]}},{key:"refreshEnv",value:function(){this.isNotVirtual()||Ye.racePong([{key:"gitlab",url:"http://gitlab.os.adc.com"}],(function(e){be("is_virtual_env","".concat(!(!e||"gitlab"!==e.key||!e.connection),"|",Date.now()))}))}},{key:"isNotVirtual",value:function(){return-1===Je.toLowerCase().indexOf("win")||1240>screen.width}}]),e}();function et(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];return ot(!0===t[0],!1,t)}function tt(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];return ot(!0===t[0],!0,t)}function nt(e){if(Array.isArray(e)){for(var t=[],n=0;e.length>n;++n)t.push(nt(e[n]));return t}if(rt(e)){var r={};for(var i in e)r[i]=nt(e[i]);return r}return e}function rt(e){return e&&"object"===Q(e)&&!Array.isArray(e)}function it(e,t){if(!rt(e))return t;for(var n in t)"__proto__"!==n&&"constructor"!==n&&"prototype"!==n&&(e[n]=rt(e[n])&&rt(t[n])?it(e[n],t[n]):t[n]);return e}function ot(e,t,n){var r;!e&&rt(r=n.shift())||(r={});for(var i=0;n.length>i;++i){var o=n[i];if(rt(o))for(var a in o)if("__proto__"!==a&&"constructor"!==a&&"prototype"!==a){var s=e?nt(o[a]):o[a];r[a]=t?it(r[a],s):s}}return r}var at,st,ct=function(){var e,t,n;return{origin:null===(e=location)||void 0===e?void 0:e.origin,pathname:null===(t=location)||void 0===t?void 0:t.pathname,href:null===(n=location)||void 0===n?void 0:n.href}},ut=null,lt=ct(),ft=null,dt=lt,pt="",vt=!1,ht=function(e){return"function"==typeof e};function gt(e,t){var n,r,i,o,a,s,c=null===(n=window)||void 0===n||null===(r=n.history)||void 0===r?void 0:r.pushState,u=null===(i=window)||void 0===i||null===(o=i.history)||void 0===o?void 0:o.replaceState,l=function(){t(location,ut)||e(location,ut)},f=!0,d=function(){var e;if(f=!f){var n=history.__proto__.pushState;n.apply(history,arguments)}else{pt="pushState",dt=ut=ct();var r=at||c;at=null,r.apply(null===(e=window)||void 0===e?void 0:e.history,arguments),lt=ct(),f=!0,l(),vt?vt=!1:t(lt,ut)||mt.watchRoutes().forEach((function(e){return e(lt,ut)}))}},p=function(){var e;if(f=!f){var n=history.__proto__.replaceState;n.apply(history,arguments)}else{pt="replaceState",dt=ut=ct();var r=st||u;st=null,r.apply(null===(e=window)||void 0===e?void 0:e.history,arguments),lt=ct(),f=!0,l(),vt?vt=!1:t(lt,ut)||mt.watchRoutes().forEach((function(e){return e(lt,ut)}))}},v=function(){(ut=lt)||ft||(vt=!0),ft=lt,pt||(ut=ft),pt="",lt=dt=ct(),l(),vt?vt=!1:t(dt,ft)||mt.watchRoutes().forEach((function(e){return e(dt,ft)}))};ht(c)&&(window.history.pushState=d),ht(u)&&(window.history.replaceState=p),s=(null===(a=window)||void 0===a?void 0:a.document.documentMode)?"hashchange":c?"popstate":"hashchange",G.addEvent(window,s,v);setTimeout((function e(){var t,n=!1,r=(null===(t=window)||void 0===t?void 0:t.history)||{};ht(c)&&r.pushState!==d&&(at=r.pushState,n=!0),ht(u)&&r.replaceState!==p&&(st=r.replaceState,n=!0),n&&(G.removeEvent(window,s,v),G.addEvent(window,s,v)),setTimeout(e,1e3)}),1e3)}var mt=function(){function e(){B(this,e)}return z(e,null,[{key:"init",value:function(e,t,n){var r=this;if(this.inited)throw Error("TrackUrlListener重复初始化!");return this.listeners="function"==typeof t?[t]:Z(this.listeners),this.isSingleApp=e,e&&gt((function(e,t){r.listeners.forEach((function(n){n(e,t)}))}),n),this.inited=!0,this}},{key:"push",value:function(e){e&&this.listeners.push(e)}},{key:"remove",value:function(e){this.listeners=this.listeners.filter((function(t){return t!==e}))}},{key:"getPrevUrl",value:function(){return this.isSingleApp&&ut?ut.href:document.referrer||""}},{key:"watchRoutes",value:function(e){return void 0!==e&&(this.routerListeners=e),this.routerListeners}}]),e}();mt.listeners=[],mt.routerListeners=[],mt.isSingleApp=void 0,mt.inited=void 0;var yt=function(e){return"object"===n(e)&&(e=JSON.stringify(e)),function(e){for(var t,n,r,i,o="",a=0,s=(e+="").length%3;e.length>a;)((n=e.charCodeAt(a++))>255||(r=e.charCodeAt(a++))>255||(i=e.charCodeAt(a++))>255)&&console.log("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range."),o+=Oe.charAt((t=n<<16|r<<8|i)>>18&63)+Oe.charAt(t>>12&63)+Oe.charAt(t>>6&63)+Oe.charAt(63&t);return s?o.slice(0,s-3)+"===".substring(s):o}(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(function(e,t){return String.fromCharCode("0x"+t)})))},_t=function(e){var t,n,r={domestic:"".concat(I.DOMESTIC,"/").concat(I.FILES_COMMON,"/").concat(e),foreign:"".concat(I.FOREIGN,"/").concat(I.FILES_COMMON,"/").concat(e),intranet:"".concat(I.INTRANET,"/").concat(I.FILES_COMMON,"/").concat(e)},i=new Ze((n=(null===(t=location)||void 0===t?void 0:t.hostname)||"",!!(/\.example$/.test(n)||"localhost"===n||/\.wanyol\.com$/.test(n)||-1!==n.indexOf("test")||-1!==n.indexOf("dev")||/^\d+(?:.\d+){3}$/.test(n))));return"zh-CN"===navigator.language?i.isInCloud()?r.intranet:r.domestic:i.isInCloud()?r.intranet:r.foreign},wt=function(e){if(!e)return e;var t=atob(e).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}));return decodeURIComponent(t.join(""))},kt=function(e){var t=yt(e);return{data:{data:t,crc:function(e){var t=0;if(0==e.length)return t;for(var n=0;e.length>n;n++)t=(t<<5)-t+e.charCodeAt(n),t&=t;return t}(t)},headers:{"Content-Type":"application/x-www-form-urlencoded"}}},bt=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"SG";t=t||{};var r=Fe(n).toUpperCase(),i=(t["AreaCode_".concat(r)]||"").trim();return e?e[n.toUpperCase()]||e[r]||i:i||"https://obus-sg.dc.heytapmobile.com"},Tt=function(e,t,n){return e.replace("$HOST",t).replace("$APPID",n)};function Et(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function St(e){for(var t=1;arguments.length>t;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Et(Object(n),!0).forEach((function(t){At(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Et(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function It(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ct(e,t){for(var n=0;t.length>n;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ot(e,t,n){return t&&Ct(e.prototype,t),n&&Ct(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function At(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function xt(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;o.length>r;r++)0>t.indexOf(n=o[r])&&(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;o.length>r;r++)0>t.indexOf(n=o[r])&&Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function Dt(e){return function(e){if(Array.isArray(e))return $t(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return $t(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?$t(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);t>n;n++)r[n]=e[n];return r}var Lt=["config_code"],Pt={dev:"https://dev-appconf.wanyol.com",test:"https://app-conf.wanyol.com",getProdUrl:function(e){return"cn"===e?"https://appconf.heytapdownload.com":"sg"===e||"sgp"===e?"https://appconf-sgp.heytapdl.com":"https://appconf-".concat(e.toLocaleLowerCase(),".heytapdl.com")}},jt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"prod";if(-1===["prod"].indexOf(t))return"https://test-obus-track-jssdk.wanyol.com";switch(e){case"cn":return"https://obus-jssdk-cn.heytapmobi.com";case"us":case"in":case"sg":return"https://obus-jssdk-".concat(e,".heytapmobile.com");case"eu":return"https://obus-jssdk-fr.heytapmobile.com";default:return"https://obus-jssdk-sg.heytapmobile.com"}},Nt=function(){function e(t){It(this,e),this.cloudEnvDetector=null,this.cloudEnvDetector=new Ze(t)}return Ot(e,[{key:"checkUpdateUrl",value:function(e,t){if(we("__VPN__"))return e;var n=t||"sg",r=(He[n.toUpperCase()]||n).toLocaleLowerCase();return"".concat(jt(r),"/api/checkUpdate")}},{key:"cdnUrl",value:function(e,t){if(we("__VPN__"))return e;var n=t||"sg",r=(He[n.toUpperCase()]||n).toLocaleLowerCase();return"".concat(jt(r),"/api/fetchCdnFile")}}]),e}(),Rt=function(){function e(t){if(It(this,e),this.options=void 0,this.configList=[],this.proxyConfigHost=void 0,this.options=St(St({},{env:"prod",countryCode:"cn",productId:"",expires:"6h",condition:null}),t),this.options.env=this.options.env||"prod",this.configList=be(this.STORAGE_KEY)||[],this.proxyConfigHost=new Nt(this.isDebugEnv()),be(this.STORAGE_KEY_NO_USED))try{localStorage.removeItem(this.STORAGE_KEY_NO_USED)}catch(e){}}return Ot(e,[{key:"fetch",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=Array.isArray(e)?e:[e],o=this.configMap,a=[];i=ve(i),r?a=i.map((function(e){return{configCode:e,version:0}})):i.forEach((function(e){o[e]?n.isConfigExpired(o[e])&&a.push({configCode:e,version:o[e].version}):a.push({configCode:e,version:0})}));var s=i.filter((function(e){return a.every((function(t){return e!==t.configCode}))})),c=s.map((function(e){return o[e]}));this.fetchConfig(a,(function(e,r){if(r=(r=r||[]).map((function(e){return St({name:e.config_code},xt(e,Lt))})),-1===e)return t&&t.call(n,i.map((function(e){return n.configMap[e]}))),ce.error("fetch config error occur.");ce.debug("拉取配置".concat(r.map((function(e){return e.name})),"成功"),r),1===e&&n.writeStorage(r),t&&t.call(n,[].concat(Dt(r),Dt(c)))}))}},{key:"refresh",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1?arguments[1]:void 0,r=this.configList,i=r;t||(i=r.filter((function(t){return e.isConfigExpired(t)}))),this.fetchConfig(i.map((function(e){return{version:e.version,configCode:e.name}})),(function(t,r){if(-1===t)return ce.error("fetch config error occur.");ce.info("刷新应用云控配置成功, 即将刷新页面"),1===t&&(e.writeStorage(r),setTimeout((function(){"function"==typeof n&&n()}),200))}))}},{key:"writeStorage",value:function(e){var t=this,n=[],r={};e.forEach((function(e){r[e.name]=!0,n.push({name:e.name,version:e.version,expire:t.getExpireTime(e.interval_time),created:Date.now(),content:e.content})})),this.configList.forEach((function(e){r[e.name]||n.push(e)})),this.configList=n,be(this.STORAGE_KEY,n)}},{key:"getExpireTime",value:function(e){return Date.now()+this.getExpireTimeMills(e)}},{key:"getExpireTimeMills",value:function(e){var t=this.options.expires||"",n=1;if(""!==(t=t.replace(/^\s+.*?\s+$/,""))&&t.length>=2){var r=t.charAt(t.length-1).toLocaleLowerCase();"d"===r?n=864e5:"h"===r?n=36e5:"m"===r?n=6e4:"s"===r&&(n=1e3)}return t?n*parseInt(t.slice(0,-1),10):1e3*e}},{key:"fetchConfig",value:function(e,t){var n=this,r=this.options,i={itemList:e,productId:r.productId};if(r.condition&&(i.systemCondition=r.condition),!e||Array.isArray(e)&&0===e.length)return t&&t(0,this.configList);ce.debug("拉取云控配置",e.map((function(e){return e.configCode})));var o=this.getCheckUpdateUrl();qe(this.proxyConfigHost.checkUpdateUrl(o,r.countryCode),{data:{body:JSON.stringify(i),url:o},reTryCount:2,success:function(e){if(200==+e.error_code){var r=e.item_list.filter((function(e){return e.version>0&&!!e.url}));if(!r||0===r.length)return ce.warn("合法的配置树为0，请检查配置项名称"),t&&t(-1,null),!1;n.fetchCdnFile(r,(function(e,n){if(e)return ce.info("拉取cdn文件异常"),t&&t(-1,null),!1;t&&t(1,n)}))}},fail:function(){return t&&t(-1,null),ce.error("fetch config error")}})}},{key:"fetchCdnFile",value:function(e,t){var n=this,r=[],i=e.length;e.forEach((function(e){qe(n.proxyConfigHost.cdnUrl(e.url,n.options.countryCode),{data:{url:e.url},reTryCount:2,success:function(n){i--,r.push(St(St({},e),{},{content:n})),0===i&&t&&t(!1,r)},fail:function(){0===i&&t&&t(!1,r)}})}))}},{key:"isConfigExpired",value:function(e){var t=Date.now();return!!e.created&&t-(null==e?void 0:e.created)>=this.getExpireTimeMills(1)||!!e.expire&&t>=(null==e?void 0:e.expire)}},{key:"config",get:function(){return this.configList}},{key:"getCheckUpdateUrl",value:function(){var e=this.options.env||"prod",t=this.options.countryCode||"sg",n="sg";return 0>["dev","test"].indexOf(e)?("prod"===e.toLocaleLowerCase()&&(n=(He[t.toUpperCase()]||t).toLocaleLowerCase()),"".concat(Pt.getProdUrl(n),"/js/v2/checkUpdate")):"".concat(Pt[e],"/js/v2/checkUpdate")}},{key:"isDebugEnv",value:function(){var e,t=(null===(e=location)||void 0===e?void 0:e.hostname)||"";return!!(/\.example$/.test(t)||"localhost"===t||/\.wanyol\.com$/.test(t)||-1!==t.indexOf("test")||-1!==t.indexOf("dev")||/^\d+(?:.\d+){3}$/.test(t))}},{key:"configMap",get:function(){for(var e={},t=0;this.configList.length>t;t++)e[this.configList[t].name]=this.configList[t];return e}},{key:"STORAGE_KEY",get:function(){return"__mdp_cloud_config/".concat(this.options.productId,"_").concat(this.options.env)}},{key:"STORAGE_KEY_NO_USED",get:function(){return"__mdp_cloud_config/".concat(this.options.productId)}}],[{key:"multiFetch",value:function(e,t){if("Array"!==Object.prototype.toString.call(e).slice(8,-1))throw Error("参数错误");if(e.forEach((function(e){if("function"!=typeof e)throw Error("参数错误")})),t.timeout=t.timeout||20,1===e.length)return e[0]((function(e){var n=At({},this.options.productId,he(e,"name",!0));return t.success(n)}));var n=e.length,r={},i=setTimeout((function(){n>0&&t.fail&&t.fail(r,e.length-n)}),1e3*t.timeout);e.forEach((function(e){e((function(e){r=St(St({},r),{},At({},this.options.productId,he(e,"name",!0))),0==--n&&(t.success(r),window.clearTimeout(i))}))}))}}]),e}();Rt.VERSION="1.5.45";var Ut={interval_time:[1,0,15],max_batch_events:[3,0,15],fail_timeout:[30,0,90],fail_retry_count:[1,0,3]};function Mt(e,t){for(var n in e)if(e.hasOwnProperty(n)){if("number"!=typeof e[n])continue;var r=+e[n],i=t[n];if(-1===r||void 0===i)continue;"number"==typeof i[0]&&(null==i[1]&&(i[1]=-1/0),void 0===i[2]&&(i[1]=1/0)),(i[1]>r||r>i[2])&&(r=+i[0]),e[n]=r}return e}var qt,Ht=function(e){var t,n,r,i,o;if(function(e,t){Ce(e,(function(e,n){return-1===t.indexOf(n)}))}(e,["balance","flush","event_rule","event_blacklist"]),o=et(!0,e),!e.app_id||!e.app_key||"**"==e.app_id)return console.error("app_id, app_key为空或者不合法"),[!1,""];if(e.env&&["test","pre","prod"].includes(e.env)||(o.env="prod"),e.region&&["sg","cn","in","eu","us"].includes(e.region.toLowerCase())||(ce.warn("当前region为：".concat(e.region,",请填写正确的region，如：sg,cn,in,eu,us中的一个")),o.region="sg"),"number"!=typeof e.interval_time||15>=e.interval_time&&e.interval_time>0||(o.interval_time=1),"number"==typeof e.max_batch_events&&(e.max_batch_events>20||0>e.max_batch_events)&&(o.max_batch_events=3),"number"==typeof e.max_request_queue&&(e.max_request_queue>20||0>e.max_request_queue)&&(o.max_request_queue=10),(o.session_cutting_time>150||20>o.session_cutting_time)&&(o.session_cutting_time=30),q(null===(t=e.pageview)||void 0===t?void 0:t.track_ignore)){var a,s=null===(a=e.pageview)||void 0===a?void 0:a.track_ignore;o.pageview.track_ignore=function(e){return 0!==s.length&&-1!==s.indexOf(e.pathname)}}"number"==typeof(null===(n=e.pageview)||void 0===n?void 0:n.delay)&&(null===(r=e.pageview)||void 0===r?void 0:r.delay)>5e3&&0>(null===(i=e.pageview)||void 0===i?void 0:i.delay)&&(e.pageview.delay=10);var c=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return{catch_js_error:e,performance:e,errorRatio:.2,errorSplit:500}};return"boolean"==typeof e.develop&&e.develop?o.develop=c(!0):"boolean"==typeof e.develop||e.develop||(o.develop=c()),o.develop=et(!0,c(),e.develop),[!0,o]},Ft=function(e){if(!e)return{event_rule:[],event_blacklist:[],business:{}};e.event_rule=(null==e?void 0:e.event_rule)||[],e.event_blacklist=(null==e?void 0:e.event_blacklist)||[];var t=Ce(null==e?void 0:e.business,(function(e){return-1!==e}));return e.business=Mt(t,Ut),e},Gt={},Vt=function(e,t){if(e.eventId=e.eventId+"",e.eventGroup=e.eventGroup+"",0===e.eventId.indexOf("$")&&/^\$track_/.test(e.eventGroup))return!1;if(0===t.event_rule.length)return!0;!Gt.white&&t.event_rule&&t.event_rule.forEach((function(e){Gt.white=Gt.white||{},Gt.white["".concat(e.eventId,"|").concat(e.eventGroup)]=!0})),!Gt.black&&t.event_blacklist&&t.event_blacklist.forEach((function(e){var t=e.blackKey;Gt.black=Gt.black||{},(t&&q(t)&&t.length>=0||void 0===t)&&(Gt.black["".concat(e.eventId,"|").concat(e.eventGroup)]=t)}));var n="".concat(e.eventId,"|").concat(e.eventGroup),r=!Gt.white||!Gt.white[n];if(!Gt.black||!t.event_blacklist)return r;var i=Gt.black[n];return!(!Gt.black.hasOwnProperty(n)||void 0!==i)||(i&&i.length>0&&i.forEach((function(t){e.properties.hasOwnProperty(t)&&delete e.properties[t]})),r)},Wt=function(){function e(){r(this,e)}return o(e,null,[{key:"init",value:function(t,n){var r,i,o;this.oTrack=n;var s=v(Ht(t),2),c=s[0],u=s[1];if(this._conf)ce.warn("基础配置不能重复初始化, 请检查");else if(c&&"string"!=typeof u){"prod"===u.env&&se.disableAllLog(),u.log_level&&se.setLogLevel(u.log_level),ce.info("当前埋点SDK版本".concat(null===(r=e.pkgInfo)||void 0===r?void 0:r.version,", 当前云控SDK版本").concat("1.5.45")),ce.info("用户配置",t),this._conf=tt(!0,S,E,u);var l="AreaCode_",f="https://",d=".heytapmobile.com",p="https://obus-dct-cn.heytapmobi.com";this.cfg={upload_host:"prod"===u.env?(i={},a(i,"".concat(l,"CN"),"".concat(f,"obus-cn.dc.heytapmobi.com")),a(i,"".concat(l,"IN"),"".concat(f,"obus-in.dc").concat(d)),a(i,"".concat(l,"SG"),"".concat(f,"obus-sg.dc").concat(d)),a(i,"".concat(l,"EU"),"".concat(f,"obus-dc-eu").concat(d)),a(i,"".concat(l,"US"),"".concat(f,"obus-dc-us").concat(d)),i):(o={},a(o,"".concat(l,"CN"),p),a(o,"".concat(l,"IN"),p),a(o,"".concat(l,"SG"),p),a(o,"".concat(l,"EU"),p),a(o,"".concat(l,"US"),p),o)},this.uploadHost=bt("",this.cfg.upload_host,u.region),this.fetchCloudConfig(u)}else ce.error(u)}},{key:"fetchCloudConfig",value:function(e){var t=this,n=this.pkgInfo.version,r=+n.split(".")[0]>1?+n.split(".")[0]:1,i="TrackGlobalWeb".concat(r),o="BUSINESS_WEB_".concat(e.app_id,"_CONFIG");"pre"!==e.env&&"test"!==e.env||(i="".concat(i,"_").concat(e.env)),this.readyState=k.FETCH_CONFIG,this.uploadHost=bt("",this.cfg.upload_host,e.region),this.cloudAppConfig=new Rt({env:e.env&&"prod"===e.env.toLowerCase()?"prod":"test",productId:"compass_".concat(e.app_id),countryCode:e.region,expires:"prod"===e.env?"3h":"30s",condition:{regionCode:"eu"===e.region.toLowerCase()?"EUEX":e.region}}),Rt.multiFetch([function(e){return t.cloudAppConfig.fetch([o],e)}],{success:function(n){var r,i,a,s=null===(r=n["compass_".concat(e.app_id)][o])||void 0===r?void 0:r.content,c=(null===(i=s)||void 0===i?void 0:i.domain)||"";ce.debug("应用ID:"+e.app_id,"应用配置",s),s||ce.error("云控配置拉取异常","请你先在OBus创建类型为web的应用, 有问题请联系80252692, 80346696");var u,l=null===(a=s=Ft(s))||void 0===a?void 0:a.business,f=s||{event_rule:[],event_blacklist:[]},d=tt(!0,S,E,e,{appDomain:c,event_rule:f.event_rule,event_blacklist:f.event_blacklist},l),p=be("host")||"";if(""===(u=function(){var e=window.location.host;return e.indexOf("localhost")>=0||e.indexOf(".example")>=0||e.indexOf(".wanyol.com")>=0||/\d+(.\d+)+/.test(e)}()&&""!==p?p:bt(c,t.cfg.upload_host,d.region))||!/^https?:\/\//.test(u))return ce.error("云控配置",u,"上报域名不合法, 请联系OBus"),!1;mt.init(d.is_single_page_app,[],d.pageview.track_ignore),t.uploadHost=u,t.readyState=k.READY,t._conf=d,t.consumeListeners(),ce.debug("应用ID:"+d.app_id,"host: ".concat(u),"埋点配置",d)},fail:function(e,n){ce.error("应用ID:"+e.app_id,"拉取云配置失败"),t.readyState=k.INIT}})}},{key:"registerCallbacks",value:function(e){this.isReady()?(this.listeners.push(e),this.consumeListeners()):this.listeners.push(e)}},{key:"setPkgInfo",value:function(e){this.pkgInfo=e}},{key:"getPkgInfo",value:function(){return this.pkgInfo}},{key:"config",get:function(){if(!this._conf)throw Error("配置没有初始化");return this._conf}},{key:"isReady",value:function(){return this.readyState===k.READY}},{key:"consumeListeners",value:function(){var e=this;this.listeners.forEach((function(t){H(t)&&t(e._conf)})),this.listeners=[]}}]),e}();function Qt(e){var t=(e.stack||"").replace(/\n/gi,"").split(/\bat\b/).slice(0,9).join("@").replace(/\?[^:]+/gi,""),n=""+e;return 0>t.indexOf(n)&&(t=n+"@"+t),t}Wt._conf=void 0,Wt.pkgInfo=void 0,Wt.readyState=k.INIT,Wt.cloudGlobalConfig=void 0,Wt.cloudAppConfig=void 0,Wt.listeners=[],Wt.uploadHost="",Wt.oTrack=void 0,Wt.cfg=void 0;var Bt,Kt,zt,Jt,Xt,Yt,Zt,en=-1,tn=function(e){addEventListener("pageshow",(function(t){t.persisted&&(en=t.timeStamp,e(t))}),!0)},nn=function(){return window.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0]},rn=function(){var e=nn();return e&&e.activationStart||0},on=function(e,t){var n=nn(),r="navigate";return 0>en?n&&(r=document.prerendering||rn()>0?"prerender":n.type.replace(/_/g,"-")):r="back-forward-cache",{name:e,value:void 0===t?-1:t,rating:"good",delta:0,entries:[],id:"v3-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12),navigationType:r}},an=function(e,t,n){try{if(PerformanceObserver.supportedEntryTypes.includes(e)){var r=new PerformanceObserver((function(e){t(e.getEntries())}));return r.observe(Object.assign({type:e,buffered:!0},n||{})),r}}catch(e){}},sn=function(e,t){var n=function n(r){"pagehide"!==r.type&&"hidden"!==document.visibilityState||(e(r),t&&(removeEventListener("visibilitychange",n,!0),removeEventListener("pagehide",n,!0)))};addEventListener("visibilitychange",n,!0),addEventListener("pagehide",n,!0)},cn=function(e,t,n,r){var i,o;return function(a){t.value>=0&&(a||r)&&((o=t.value-(i||0))||void 0===i)&&(i=t.value,t.delta=o,t.rating=function(e,t){return e>t[1]?"poor":e>t[0]?"needs-improvement":"good"}(t.value,n),e(t))}},un=-1,ln=function(){return"hidden"!==document.visibilityState||document.prerendering?1/0:0},fn=function(){sn((function(e){un=e.timeStamp}),!0)},dn=function(){return 0>un&&(un=ln(),fn(),tn((function(){setTimeout((function(){un=ln(),fn()}),0)}))),{get firstHiddenTime(){return un}}},pn=function(e,t){t=t||{};var n,r=[1800,3e3],i=dn(),o=on("FCP"),a=function(e){e.forEach((function(e){"first-contentful-paint"===e.name&&(c&&c.disconnect(),i.firstHiddenTime>e.startTime&&(o.value=e.startTime-rn(),o.entries.push(e),n(!0)))}))},s=window.performance&&window.performance.getEntriesByName&&window.performance.getEntriesByName("first-contentful-paint")[0],c=s?null:an("paint",a);(s||c)&&(n=cn(e,o,r,t.reportAllChanges),s&&a([s]),tn((function(i){o=on("FCP"),n=cn(e,o,r,t.reportAllChanges),requestAnimationFrame((function(){requestAnimationFrame((function(){o.value=performance.now()-i.timeStamp,n(!0)}))}))})))},vn=!1,hn=-1,gn={passive:!0,capture:!0},mn=new Date,yn=function(e,t){Bt||(Bt=t,Kt=e,zt=new Date,kn(removeEventListener),_n())},_n=function(){if(Kt>=0&&zt-mn>Kt){var e={entryType:"first-input",name:Bt.type,target:Bt.target,cancelable:Bt.cancelable,startTime:Bt.timeStamp,processingStart:Bt.timeStamp+Kt};Jt.forEach((function(t){t(e)})),Jt=[]}},wn=function(e){if(e.cancelable){var t=(e.timeStamp>1e12?new Date:performance.now())-e.timeStamp;"pointerdown"==e.type?function(e,t){var n=function(){yn(e,t),i()},r=function(){i()},i=function(){removeEventListener("pointerup",n,gn),removeEventListener("pointercancel",r,gn)};addEventListener("pointerup",n,gn),addEventListener("pointercancel",r,gn)}(t,e):yn(t,e)}},kn=function(e){["mousedown","keydown","touchstart","pointerdown"].forEach((function(t){return e(t,wn,gn)}))},bn={},Tn=function e(t){document.prerendering?addEventListener("prerenderingchange",(function(){return e(t)}),!0):"complete"!==document.readyState?addEventListener("load",(function(){return e(t)}),!0):setTimeout(t,0)},En=function(e,t){t=t||{};var n=[800,1800],r=on("TTFB"),i=cn(e,r,n,t.reportAllChanges);Tn((function(){var o=nn();if(o){if(r.value=Math.max(o.responseStart-rn(),0),0>r.value||r.value>performance.now())return;r.entries=[o],i(!0),tn((function(){r=on("TTFB",0),(i=cn(e,r,n,t.reportAllChanges))(!0)}))}}))};function Sn(e){var t,n=function(t){e({eventId:"$track_perf_".concat(t.name.toLocaleLowerCase()),eventGroup:"$track_develop",properties:{value:t.value.toFixed(3)}})};(null===(t=window)||void 0===t?void 0:t.performance)&&Wt.config.develop.performance&&(!function(e,t){t=t||{};var n=[.1,.25];vn||(pn((function(e){hn=e.value})),vn=!0);var r,i=function(t){hn>-1&&e(t)},o=on("CLS",0),a=0,s=[],c=function(e){e.forEach((function(e){e.hadRecentInput||(a&&1e3>e.startTime-s[s.length-1].startTime&&5e3>e.startTime-s[0].startTime?(a+=e.value,s.push(e)):(a=e.value,s=[e]),a>o.value&&(o.value=a,o.entries=s,r()))}))},u=an("layout-shift",c);u&&(r=cn(i,o,n,t.reportAllChanges),sn((function(){c(u.takeRecords()),r(!0)})),tn((function(){a=0,hn=-1,o=on("CLS",0),r=cn(i,o,n,t.reportAllChanges)})))}(n),function(e,t){t=t||{};var n,r=[100,300],i=dn(),o=on("FID"),a=function(e){i.firstHiddenTime>e.startTime&&(o.value=e.processingStart-e.startTime,o.entries.push(e),n(!0))},s=function(e){e.forEach(a)},c=an("first-input",s);n=cn(e,o,r,t.reportAllChanges),c&&sn((function(){s(c.takeRecords()),c.disconnect()}),!0),c&&tn((function(){o=on("FID"),n=cn(e,o,r,t.reportAllChanges),Jt=[],Kt=-1,Bt=null,kn(addEventListener),Jt.push(a),_n()}))}(n),pn(n),function(e,t){t=t||{};var n,r=[2500,4e3],i=dn(),o=on("LCP"),a=function(e){var t=e[e.length-1];if(t){var r=t.startTime-rn();i.firstHiddenTime>r&&(o.value=r,o.entries=[t],n())}},s=an("largest-contentful-paint",a);if(s){n=cn(e,o,r,t.reportAllChanges);var c=function(){bn[o.id]||(a(s.takeRecords()),s.disconnect(),bn[o.id]=!0,n(!0))};["keydown","click"].forEach((function(e){addEventListener(e,c,{once:!0,capture:!0})})),sn(c,!0),tn((function(i){o=on("LCP"),n=cn(e,o,r,t.reportAllChanges),requestAnimationFrame((function(){requestAnimationFrame((function(){o.value=performance.now()-i.timeStamp,bn[o.id]=!0,n(!0)}))}))}))}}(n),En(n))}function In(e){return new In.init(e)}function Cn(e,t){return e.indexOf(t)}function On(e,t){return e.hasAttribute?e.hasAttribute(t):e.attributes?!(!e.attributes[t]||!e.attributes[t].specified):void 0}function An(e,t){if("string"==typeof t)return On(e,t);if(q(t)){for(var n=!1,r=0;t.length>r;r++){if(On(e,t[r])){n=!0;break}}return n}}function xn(e,t,r){function i(e,t,r){var i=null;if((e=e||{}).ele&&(i=e.ele),e.event&&(i=e.target?e.target:e.event.target),r=r||{},!i||"object"!==n(i))return!1;if(!i.href||/^javascript/.test(i.href)||i.target||i.download||i.onclick)return Xt(t,r),!1;function o(e){e.stopPropagation(),e.preventDefault();var n=!1;function o(){n||(n=!0,location.href=i.href)}setTimeout(o,1e3),Xt(t,r,o)}e.event&&o(e.event),e.ele&&G.EventUtils(e.ele,"click",(function(e){o(e)}))}"object"===n(e)&&e.tagName?i({ele:e},t,r):"object"===n(e)&&e.target&&e.event&&i(e,t,r)}function Dn(e){if(!e.target)return!1;var t=e.target,n=t.tagName.toLowerCase(),r={};return r.$element_type=n,r.$element_name=t.getAttribute("name"),r.$element_id=t.getAttribute("id"),r.$element_class_name="string"==typeof t.className?t.className:null,r.$element_target_url=t.getAttribute("href"),r.$element_content=function(e,t){var n="",r="";e.textContent?n=xe(e.textContent):e.innerText&&(n=xe(e.innerText));n&&(n=n.replace(/[\r\n]/g," ").replace(/[ ]+/g," ").substring(0,255));r=n||"",("input"===t||"INPUT"===t)&&("button"===e.type||"submit"===e.type||Yt&&"function"==typeof Yt.collect_input&&Yt.collect_input(e))&&(r=e.value||"");return r}(t,n),r=function(e){var t={};for(var n in e)null!==e[n]&&(t[n]=e[n]);return t}(r),r}(In.init=function(e){this.ele=e}).prototype={addClass:function(e){return-1===(" "+this.ele.className+" ").indexOf(" "+e+" ")&&(this.ele.className=this.ele.className+(""===this.ele.className?"":" ")+e),this},removeClass:function(e){var t=" "+this.ele.className+" ";return-1!==t.indexOf(" "+e+" ")&&(this.ele.className=t.replace(" "+e+" "," ").slice(1,-1)),this},hasClass:function(e){return-1!==(" "+this.ele.className+" ").indexOf(" "+e+" ")},attr:function(e,t){return"string"==typeof e&&isUndefined(t)?this.ele.getAttribute(e):("string"==typeof e&&this.ele.setAttribute(e,t+=""),this)},offset:function(){var e=this.ele.getBoundingClientRect();if(e.width||e.height){var t=this.ele.ownerDocument.documentElement;return{top:e.top+window.pageYOffset-t.clientTop,left:e.left+window.pageXOffset-t.clientLeft}}return{top:0,left:0}},getSize:function(){if(!window.getComputedStyle)return{width:this.ele.offsetWidth,height:this.ele.offsetHeight};try{var e=this.ele.getBoundingClientRect();return{width:e.width,height:e.height}}catch(e){return{width:0,height:0}}},getStyle:function(e){return this.ele.currentStyle?this.ele.currentStyle[e]:this.ele.ownerDocument.defaultView.getComputedStyle(this.ele,null).getPropertyValue(e)},wrap:function(e){var t,n=null===(t=document)||void 0===t?void 0:t.createElement(e);return this.ele.parentNode.insertBefore(n,this.ele),n.appendChild(this.ele),In(n)},getCssStyle:function(e){var t=this.ele.style.getPropertyValue(e);if(t)return t;var n=null;if("function"==typeof window.getMatchedCSSRules&&(n=window.getMatchedCSSRules(this.ele)),!n||!isArray(n))return null;for(var r=n.length-1;r>=0;r--){if(t=n[r].style.getPropertyValue(e))return t}},sibling:function(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e},next:function(){return this.sibling(this.ele,"nextSibling")},prev:function(){return this.sibling(this.ele,"previousSibling")},siblings:function(){return this.siblings((this.ele.parentNode||{}).firstChild,this.ele)},children:function(){return this.siblings(this.ele.firstChild)},parent:function(){var e=this.ele.parentNode;return e=e&&11!==e.nodeType?e:null,In(e)},previousElementSibling:function(){var e=this.ele;if("previousElementSibling"in document.documentElement)return In(e.previousElementSibling);for(;e=e.previousSibling;)if(1===e.nodeType)return In(e);return In(null)},getSameTypeSiblings:function(){for(var e=this.ele,t=e.parentNode,n=e.tagName.toLowerCase(),r=[],i=0;t.children.length>i;i++){var o=t.children[i];1===o.nodeType&&o.tagName.toLowerCase()===n&&r.push(t.children[i])}return r},getParents:function(){try{var e=this.ele;if(!isElement(e))return[];var t=[e];if(null===e||null===e.parentElement)return[];for(;null!==e.parentElement;)t.push(e=e.parentElement);return t}catch(e){return[]}}};var $n={otherTags:[],getTargetElement:function(e,t){var r=e;if("object"!==n(r))return null;if("string"!=typeof r.tagName)return null;var i=r.tagName.toLowerCase();if("body"===i.toLowerCase()||"html"===i.toLowerCase())return null;if(!r||!r.parentNode||!r.parentNode.children)return null;var o=r.parentNode,a=this.hasElement({event:t&&t.originalEvent||t,element:e},(function(e){return"a"===e.tagName.toLowerCase()||An(e,Yt.track_attr)}));if("a"===i||"button"===i||"input"===i||"textarea"===i)return r;if(Cn(this.otherTags,i)>-1)return r;if("button"===o.tagName.toLowerCase()||"a"===o.tagName.toLowerCase())return o;if("area"===i&&"map"===o.tagName.toLowerCase()&&In(o).prev().tagName&&"img"===In(o).prev().tagName.toLowerCase())return In(o).prev();if(a)return a;if("div"===i&&Yt.collect_tags.div&&this.isDivLevelValid(r))return(Yt&&Yt.collect_tags&&Yt.collect_tags.div&&Yt.collect_tags.div.max_level||1)>1||this.isCollectableDiv(r)?r:null;if(this.isStyleTag(i)&&Yt.collect_tags.div){var s=this.getCollectableParent(r);if(s&&this.isDivLevelValid(s))return s}return null},getDivLevels:function(e,t){return $n.getElementPath(e,!0,t).split(" > ").filter((function(e){return"div"===e})).length},isDivLevelValid:function(e){for(var t=Yt&&Yt.collect_tags&&Yt.collect_tags.div&&Yt.collect_tags.div.max_level||1,n=e.getElementsByTagName("div"),r=n.length-1;r>=0;r--)if($n.getDivLevels(n[r],e)>t)return!1;return!0},getElementPath:function(e,t,n){for(var r=[];e.parentNode;){if(e.id&&!t&&/^[A-Za-z][-A-Za-z0-9_:.]*$/.test(e.id)){r.unshift(e.tagName.toLowerCase()+"#"+e.id);break}if(n&&e===n){r.unshift(e.tagName.toLowerCase());break}if(e===document.body){r.unshift("body");break}r.unshift(e.tagName.toLowerCase()),e=e.parentNode}return r.join(" > ")},getClosestLi:function(e){return function(e,t){for(;e&&e!==document&&1===e.nodeType;e=e.parentNode)if(e.tagName.toLowerCase()===t)return e;return null}(e,"li")},getElementPosition:function(e,t,n){var r=$n.getClosestLi(e);if(!r)return null;var i=e.tagName.toLowerCase(),o=r.getElementsByTagName(i),a=o.length,s=[];if(a>1){for(var c=0;a>c;c++){$n.getElementPath(o[c],n)===t&&s.push(o[c])}if(s.length>1)return Cn(s,e)}return function(e){if(!e.parentNode)return"";if(1===In(e).getSameTypeSiblings().length)return 0;for(var t=0,n=e;n=In(n).previousElementSibling().ele;)t++;return t}(r)},getDomIndex:function(e){if(!e.parentNode)return-1;for(var t=0,n=e.tagName,r=e.parentNode.children,i=0;r.length>i;i++)if(r[i].tagName===n){if(e===r[i])return t;t++}return-1},selector:function(e,t){var n=e.parentNode&&9==+e.parentNode.nodeType?-1:this.getDomIndex(e);return e.getAttribute&&e.getAttribute("id")&&/^[A-Za-z][-A-Za-z0-9_:.]*$/.test(e.getAttribute("id"))&&(!Yt||Yt&&"not_use_id"!==Yt.element_selector)&&!t?"#"+e.getAttribute("id"):e.tagName.toLowerCase()+(~n?":nth-of-type("+(n+1)+")":"")},getDomSelector:function(e,t,n){if(!e||!e.parentNode||!e.parentNode.children)return!1;t=t&&t.join?t:[];var r=e.nodeName.toLowerCase();return e&&"body"!==r&&1===e.nodeType?(t.unshift(this.selector(e,n)),e.getAttribute&&e.getAttribute("id")&&/^[A-Za-z][-A-Za-z0-9_:.]*$/.test(e.getAttribute("id"))&&Yt&&"not_use_id"!==Yt.element_selector&&!n?t.join(" > "):this.getDomSelector(e.parentNode,t,n)):(t.unshift("body"),t.join(" > "))},getEleDetail:function(e){var t=this.getDomSelector(e),n=Dn({target:e});n.$element_selector=t||"",n.$element_path=$n.getElementPath(e,Yt&&"not_use_id"===Yt.element_selector);var r=$n.getElementPosition(e,n.$element_path,Yt&&"not_use_id"===Yt.element_selector);return"number"==typeof r&&(n.$element_position=r),n},start:function(e,t,n,r,i){var o=U(r)?r:{},a=H(i)?i:H(r)?r:void 0;if(!U(Yt)||"default"!==Yt.clickmap)return!1;if(Yt&&Yt.collect_element&&!Yt.collect_element(t))return!1;var s=this.getEleDetail(t);if($n&&Yt.custom_property){var c=Yt.custom_property(t);U(c)&&(s=tt(!0,s,c))}s=tt(!0,s,o),"a"===n&&$n&&!0===$n.isTrackLink?xn({event:e,target:t},L.clickId,s):Xt(L.clickId,s,a)},hasElement:function(e,t){var r;if(e.event){var i=e.event;r=i.path||i._getPath&&i._getPath()}else e.element&&(r=In(e.element).getParents());if(r&&q(r)&&r.length>0)for(var o=0;r.length>o;o++)if("object"===n(r[o])&&1===r[o].nodeType&&t(r[o]))return r[o]},isStyleTag:function(e,t){return-1>=Cn(["a","div","input","button","textarea"],e)&&(!t||Yt&&Yt.collect_tags&&Yt.collect_tags.div?!!(U($n)&&U(Yt.collect_tags)&&U(Yt.collect_tags.div)&&q(Yt.collect_tags.div.ignore_tags)&&Cn(Yt.collect_tags.div.ignore_tags,e)>-1):Cn(["mark","/mark","strong","b","em","i","u","abbr","ins","del","s","sup"],e)>-1)},isCollectableDiv:function(e,t){try{if(0===e.children.length)return!0;for(var n=0;e.children.length>n;n++)if(1===e.children[n].nodeType){var r=e.children[n].tagName.toLowerCase();if(!("div"===r&&(Yt&&Yt.collect_tags&&Yt.collect_tags.div&&Yt.collect_tags.div.max_level)>1||this.isStyleTag(r,t)))return!1;if(!this.isCollectableDiv(e.children[n],t))return!1}return!0}catch(e){Zt.error(e)}return!1},getCollectableParent:function(e,t){try{var n=e.parentNode,r=n?n.tagName.toLowerCase():"";if("body"===r)return!1;if(r&&"div"===r&&((Yt&&Yt.collect_tags&&Yt.collect_tags.div&&Yt.collect_tags.div.max_level)>1||this.isCollectableDiv(n,t)))return n;if(n&&this.isStyleTag(r,t))return this.getCollectableParent(n,t)}catch(e){Zt.error(e)}return!1},initScrollMap:function(){if(!U(Yt)||"default"!==Yt.scroll_notice_map)return!1;var e=function(e){var t={};return t.timeout=e.timeout||1e3,t.func=e.func,t.hasInit=!1,t.inter=null,t.main=function(e,t){this.func(e,t),this.inter=null},t.current_time=new Date,t.go=function(e){var n={};if(!(Yt&&H(Yt.collect_url)&&Yt.collect_url()))return!1;this.inter||(n.$viewport_position=document.documentElement&&document.documentElement.scrollTop||window.pageYOffset||document.body.scrollTop||0,n.$viewport_position=Math.round(n.$viewport_position)||0,n.$viewport_height=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight||0,n.$viewport_width=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth||0,e?t.main(n,!0):this.inter=setTimeout((function(){t.main(n)}),this.timeout))},t}({timeout:1e3,func:function(e,t){var n=document.documentElement&&document.documentElement.scrollTop||window.pageYOffset||document.body.scrollTop||0,r=new Date,i=r-this.current_time;(i>Yt.scroll_delay_time&&n-e.$viewport_position!=0||t)&&(e.event_duration=Math.min(Yt.scroll_event_duration,parseInt(i)/1e3),e.event_duration=0>e.event_duration?0:e.event_duration,Xt(L.stayId,e)),this.current_time=r}});G.addEvent(window,"scroll",(function(){e.go()})),G.addEvent(window,"unload",(function(){e.go("notime")}))},initHeatmap:function(){var e=this;return!(!U(Yt)||"default"!==Yt.clickmap)&&(!(H(Yt.collect_url)&&!Yt.collect_url())&&(Yt.collect_elements="all"===Yt.collect_elements?"all":"interact",void G.addEvent(document,"click","all"===Yt.collect_elements?function(t){var r=t||window.event;if(!r)return!1;var i=r.target||r.srcElement;if("object"!==n(i))return!1;if("string"!=typeof i.tagName)return!1;var o=i.tagName.toLowerCase();if("body"===o||"html"===o)return!1;if(!i||!i.parentNode||!i.parentNode.children)return!1;var a=i.parentNode.tagName.toLowerCase();"a"===a||"button"===a?e.start(r,i.parentNode,a):e.start(r,i,o)}:function(t){var n=t||window.event;if(!n)return!1;var r=e.getTargetElement(n.target||n.srcElement,t);r&&e.start(n,r,r.tagName.toLowerCase())})))}};var Ln={trackHeatMap:function(e,t,r){if("object"===n(e)&&e.tagName){var i=e.tagName.toLowerCase(),o=e.parentNode.tagName.toLowerCase();"button"===i||"a"===i||"a"===o||"button"===o||"input"===i||"textarea"===i||An(e,Yt&&Yt.track_attr?Yt.track_attr:["data-obus-click"])||$n.start(null,e,i,t,r)}},trackAllHeatMap:function(e,t,r){if("object"===n(e)&&e.tagName){var i=e.tagName.toLowerCase();$n.start(null,e,i,t,r)}},trackLink:xn},Pn=$n.getEleDetail.bind($n);function jn(e,t,r,i){return e?("string"==typeof r&&n(e[t])!==r&&(e[t]=i),"function"!=typeof r||r(e[t])||(e[t]=i),e):e}function Nn(e){var t=et(!0,e),n="default",r="not_collect";for(var i in!0===e&&(t.clickmap=!0,t.scroll_notice_map=!0),"boolean"==typeof t.clickmap&&(t.clickmap=t.clickmap?n:r),jn(t,"clickmap",(function(e){return e===n}),r),"boolean"==typeof t.scroll_notice_map&&(t.scroll_notice_map=t.scroll_notice_map?n:r),jn(t,"scroll_notice_map",(function(e){return e===n}),r),jn(t,"scroll_delay_time","number",4e3),jn(t,"scroll_event_duration","number",18e3),jn(t,"collect_tags",(function(e){return U(e)}),{}),jn(t,"track_attr",(function(e){return q(e)}),["data-obus-click"]),jn(t,"collect_url","function",(function(){return!0})),jn(t,"collect_element","function",(function(){return!0})),jn(t,"track_collect_input","function",(function(){return!1})),jn(t,"element_selector",(function(e){return"not_use_id"===e}),""),jn(t,"custom_property","function",(function(){return{}})),jn(t,"renderRefreshTime","number",1e3),jn(t,"loadTimeout","number",1e3),jn(t,"get_vtrack_config",(function(e){return!0!==e}),!1),t.track_attr=t.track_attr.filter((function(e){return e&&"string"==typeof e})),!0===t.collect_tags.div&&(t.collect_tags.div={max_level:1,ignore_tags:["mark","/mark","strong","b","em","i","u","abbr","ins","del","s","sup"]}),t.track_attr.push("data-obus-click"),t.collect_tags.div&&t.collect_tags.div.max_level>3&&(t.collect_tags.div.max_level=1),t.collect_tags){"div"!==i&&t.collect_tags[i]&&$n.otherTags.push(i)}return t}var Rn=function(e){var t,n=tt(!0,e,{heatmap:Nn(e.heatmap)});return null===(t=e.logger)||void 0===t||t.debug(n.heatmap),function(e){Zt=(e=e||{}).logger||console,Xt=function(t,n,r){var i=e.dispatch;i&&i({eventId:t,eventGroup:L.eventGroup,properties:n}),r&&r()},(Yt=e.heatmap)&&Xt?($n.initHeatmap(),$n.initScrollMap()):Zt.error("配置项异常")}(n)},Un=30,Mn=ce.clone({namespace:"DB读写"}),qn=function(){function e(){r(this,e),this.getVersion=function(){return Date.now()}}return o(e,[{key:"writeTypeStgSafe",value:function(e,t){var n,r,i=0;do{var o=t((n=this.readTypeStg(e)).data);if(!1===o)return n.data;n.data=o||n.data,r=this.readTypeStg(e)}while(r&&n.version!==r.version&&i++<=Un);if(i>Un)console.warn("writeTypeStgSafe try count greater than 30");else if(n.data===r.data&&n.data.length===r.data.length)return r.data||[];return this.writeTypeStg(e,{data:n.data,version:this.getVersion()}),n.data||[]}},{key:"writeTypeStgMultiSafe",value:function(e,t){var n=this,r=0,i=[],o=e.map((function(e){return n.readTypeStg(e)})),a=function(){var t=o&&r++<=Un*e.length;return e.forEach((function(e,n){t=t&&o[n].version!==i[n].version})),t};do{var s=(i=e.map((function(e){return n.readTypeStg(e)}))).map((function(e){return e.data})),c=t.apply(void 0,h(s));if(!1===c)return!1;i=(c=c||s).map((function(e,t){return{version:i[t].version,data:e}})),o=e.map((function(e){return n.readTypeStg(e)}))}while(a());r>Un&&console.warn("writeTypeStgSafe try count greater than 30"),e.forEach((function(e,t){n.writeTypeStg(e,{data:i[t].data,version:n.getVersion()})}))}},{key:"readTypeStg",value:function(e){var t=be(this.getStgQueueName(e)),n=this.getDefValAndType(e);if(n&&F(null==t?void 0:t.data)!==n[0]){var r={data:n[1],version:this.getVersion()};return this.writeTypeStg(e,r),r}return t}},{key:"readStg",value:function(e){return be(e)}},{key:"writeTypeStg",value:function(e,t){var n=this.getDefValAndType(e);return n&&n[0]!==F(null==t?void 0:t.data)?(Mn.error(e,"写入类型".concat(F(null==t?void 0:t.data),"和期待类型").concat(n[0],"不一致")),this.readTypeStg(e),!1):(be(this.getStgQueueName(e),t,!0),!0)}},{key:"writeStg",value:function(e,t){be(e,t,!0)}},{key:"getDefValAndType",value:function(e){return"balance"===e?["Object",{}]:["Array",[]]}},{key:"getStgQueueName",value:function(e){return"obus-track_".concat(Wt.config.app_id,"/").concat(e,"-queue")}}]),e}(),Hn="otrack_jssdk_store",Fn=function(){function e(){r(this,e),this.userId="",this.appVersion="",this.customAttrs=null,this.isWebview=!1,this.region="",this.isFirstDay=!1,this.isFirstTime=!1,this.isLogin=!1,this.deviceId="",this.initStore();var t=!1;if(we(Hn)){var n=null;try{n=me(wt(we(Hn))||"null")}catch(e){try{n=me(we(Hn)||"null")}catch(e){ce.error("cookies 设备信息获取失败")}}n&&(this.deviceId=n.deviceId||"",this.userId=n.userId||"",this.customAttrs=n.customAttrs||{},this.isLogin=!!this.userId,this.isFirstDay=me(we("otrack_jssdk_is_first_day")||"false"),n.deviceId||(this.deviceId=Se(),this.isFirstTime=!0,this.isFirstDay=!0,t=!0))}else""===this.deviceId&&(this.deviceId=Se(),this.isFirstTime=!0,this.isFirstDay=!0,t=!0);if(t){var i=new Date;i.setDate(i.getDate()+1),i.setHours(0,0,0,0),this.writeStore(),ye("otrack_jssdk_is_first_day",ge(this.isFirstDay),i,{cross_subdomain:Wt.config.is_cross_subdomain})}}return o(e,[{key:"initStore",value:function(){var e=Wt.config.is_cross_subdomain,t=we(Hn),n="otrack_jssdk_is_first_day",r=we(n),i=new Date;i.setDate(i.getDate()+1),i.setHours(0,0,0,0),e?(ye(Hn,"",-1),ye(n,"",-1)):(ye(Hn,"",-1,{cross_subdomain:!0}),ye(n,"false",-1,{cross_subdomain:!0}));var o=we(Hn);null!=t&&null==o&&(ye(Hn,t,73e3,{cross_subdomain:e}),r&&ye(n,r,i,{cross_subdomain:e}))}},{key:"getCustomHead",value:function(){return this.customAttrs||{}}},{key:"getDeviceId",value:function(){return this.deviceId}},{key:"setCustomHead",value:function(e){if(void 0===e)return this.customAttrs={},void this.writeStore();if(U(e)){for(var n in e)null==e[n]&&(e[n]="");this.customAttrs=t(t({},this.customAttrs),e),this.writeStore()}else ce.error("registerGlobalAttrs的参数必须是属性")}},{key:"setAppVersion",value:function(e){this.appVersion=e||""}},{key:"getAppVersion",value:function(){return this.appVersion||""}},{key:"setDeviceId",value:function(e){this.deviceId=e||"",ce.info("".concat((new Date).toLocaleString()," setDeviceId: ").concat(this.deviceId)),this.writeStore()}},{key:"setUserId",value:function(e){if("string"!=typeof e)return ce.error("userId的数据类型必需为string");this.userId=e||"",this.isLogin=!!this.userId,ce.info("".concat((new Date).toLocaleString()," setUserId: ").concat(this.userId)),this.writeStore()}},{key:"setIsWebview",value:function(e){this.isWebview=!!e}},{key:"getIsWebview",value:function(){return this.isWebview}},{key:"getUserId",value:function(){return this.userId}},{key:"writeStore",value:function(){ye(Hn,yt(ge({deviceId:this.deviceId,userId:this.userId,customAttrs:this.customAttrs})),73e3,{cross_subdomain:Wt.config.is_cross_subdomain})}},{key:"isFirstDayFromCookies",value:function(){var e=this.isFirstDay&&me(we("otrack_jssdk_is_first_day")||"null");return!e&&this.isFirstDay&&(this.isFirstDay=!1),e}}]),e}(),Gn=ce.clone({namespace:"对账数据",isShowLog:!1}),Vn=function(e){s(n,e);var t=p(n);function n(){var e;r(this,n);for(var i=arguments.length,o=Array(i),a=0;i>a;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).memoryCache={events:[],posts:[]},e.timerMap={events:0,posts:0},e.totalCreate=0,e.reportTotalCreate=[0,0],e}return o(n,[{key:"registerCreate",value:function(e,t){this.memoryCache.events.push(e),this.memoryCache.events.length>20&&(this.timerMap.events=window.setTimeout(this.registerMemoCb.bind(this),0)),0===this.timerMap.events&&(this.timerMap.events=window.setTimeout(this.registerMemoCb.bind(this),50))}},{key:"registerUpload",value:function(e,t){this.register(e,1,t)}},{key:"registerMemoCb",value:function(e){this.register(this.memoryCache.events,0,e),this.memoryCache.events=[],window.clearTimeout(this.timerMap.events),this.timerMap.events=0}},{key:"register",value:function(e,t,n){var r=this;if(e){var i={},o=0===t?"event_count":"post_count";(e&&q(e)?e:[e]).map((function(e,t){return 60*Math.floor(+e.$event_time/6e4)*1e3})).forEach((function(e){0===t&&(r.totalCreate+=1),i[e]=i[e]?i[e]+1:1})),this.reportTotalCreate[t]+=Object.keys(i).reduce((function(e,t){return e+i[t]}),0),Gn.debug("[对账调试]对账数据产生内存统计",o,this.reportTotalCreate);var a=this.writeTypeStgSafe(T.BALANCE,(function(e){for(var t in Gn.debug("[对账调试]写入前",e),Gn.debug("[对账调试]写入中",o,i),i)i.hasOwnProperty(t)&&(e[t]=e[t]||{sequence_id:Se(),event_count:0,post_count:0},e[t][o]+=i[t]);return e}));Gn.debug("[对账调试]写入后",a)}}}]),n}(qn),Wn=function(){function e(){r(this,e)}return o(e,null,[{key:"userInfo",get:function(){return this._userInfoInst||(this._userInfoInst=new Fn),this._userInfoInst}},{key:"trackBalanceCreate",get:function(){return this._balanceGenInst||(this._balanceGenInst=new Vn),this._balanceGenInst}}]),e}();Wn._userInfoInst=void 0,Wn._balanceGenInst=void 0;var Qn,Bn=function(){function e(){var t=this;r(this,e),this.spanConf={life:864e5,renewal:18e5,cookieUpdateInterval:6e4},this.cookieNameConst=void 0,this.sessionMeta=void 0,this.cookieUpdatedTime=0,this.sessionMeta={id:"",createTime:0,renewalTime:0},this.cookieNameConst="obus-track_"+Wt.config.app_id+"_session",this.spanConf.renewal=6e4*Wt.config.session_cutting_time,this.sessionMeta.id||this.restoreSession(),G.addEvent(window,"beforeunload",(function(){t.persist()})),G.addEvent(window,"unload",(function(){t.persist()}))}return o(e,[{key:"update",value:function(){var e=Date.now();e-this.sessionMeta.createTime>this.spanConf.life||e-this.sessionMeta.renewalTime>this.spanConf.renewal||""==this.sessionMeta.id?this.renew():this.cookieUpdatedTime&&this.spanConf.cookieUpdateInterval>=e-this.cookieUpdatedTime||(this.sessionMeta.renewalTime=e,this.setCookies())}},{key:"getSessionId",value:function(){return this.sessionMeta.id}},{key:"restoreSession",value:function(){var e=we(this.cookieNameConst);if(e)this.restoreSessionWithData(e);else{var t=be(this.cookieNameConst);t&&this.restoreSessionWithData(t)}this.sessionMeta.id||this.renew()}},{key:"restoreSessionWithData",value:function(e){var t=e.split(",");t.length>0&&(this.sessionMeta.id=t[0]);try{t.length>1&&(this.sessionMeta.createTime=+new Date(+t[1]),this.sessionMeta.createTime=this.sessionMeta.createTime>0?this.sessionMeta.createTime:0),t.length>2&&(this.sessionMeta.renewalTime=+new Date(+t[2]),this.sessionMeta.renewalTime=this.sessionMeta.renewalTime>0?this.sessionMeta.renewalTime:0)}catch(e){console.log("otrack 日期初始化异常")}}},{key:"renew",value:function(){this.sessionMeta={id:de(),createTime:Date.now(),renewalTime:Date.now()},this.setCookies()}},{key:"setCookies",value:function(){var e=this.sessionMeta,t=e.createTime+this.spanConf.life,n=e.renewalTime+this.spanConf.renewal,r=t>n?n:t;ye(this.cookieNameConst,[e.id,e.createTime,e.renewalTime].join(","),new Date(r),{cross_subdomain:Wt.config.is_cross_subdomain}),this.cookieUpdatedTime=Date.now()}},{key:"persist",value:function(){var e=this.sessionMeta;be(this.cookieNameConst,[e.id,e.createTime,e.renewalTime].join(","))}}]),e}(),Kn=function(){function e(){r(this,e),this.session=void 0,this.session=new Bn}return o(e,[{key:"getHeader",value:function(){var e,r,i=Wn.userInfo,o={$platform:"web",$lib_version:(null===(e=Wt.getPkgInfo())||void 0===e?void 0:e.version)||"",$lib_type:"object"===("undefined"==typeof exports?"undefined":n(exports))&&"undefined"!=typeof module?"npm":"script",$timezone_offset:(new Date).getTimezoneOffset(),$screen_height:Number(screen.height)||0,$screen_width:Number(screen.width)||0,$orientation:Qe,$doc_width:Ve,$doc_height:We,$connection_type:function(){var e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return e&&e.effectiveType||""},$browser_type:ze.type,$browser_version:ze.versions,$os:Je+","+(i.getIsWebview()?"webview":Ge.device),$session_id:this.session.getSessionId(),$browser_language:navigator.language||navigator.userLanguage||"",$browser_charset:(null===(r=document)||void 0===r?void 0:r.charset.toUpperCase())||""},s={$region:function(){return Wt.config.region},$region_code:function(){return Wt.config.region_code},$device_id:function(){return Wn.userInfo.deviceId},$is_login:function(){return Wn.userInfo.isLogin},$user_id:i.getUserId.bind(i),$app_version:i.getAppVersion.bind(i)},c=t(t({},o),s),u=Object.create(null);return Object.keys(c).forEach((function(e){var t=c[e];Object.assign(u,a({},e,"function"==typeof t?t():t))})),this.session.update(),u}}]),e}(),zn=["head","pending"],Jn=function(e){s(i,e);var n=p(i);function i(e){var t;return r(this,i),(t=n.call(this)).isSending=!1,t.continueFailCount=0,t.failIgnoreList=[],t.identity=void 0,t.logId="",t.options=void 0,t.url="",t.reportHeader=void 0,t.consumeStartThrottle=null,t.options=e,t.identity=e.identity,t.reportHeader=new Kn,t.consumeStart(!0),t}return o(i,[{key:"consumeStart",value:function(e,t){this.consumeStartThrottle||(this.consumeStartThrottle=Ae(this.consumeStartOrg.bind(this),100,{leading:!0})),this.consumeStartThrottle(e,t)}},{key:"consumeStartOrg",value:function(e,t){var n,r=this.readTypeStg(this.options.queue);if(!r||0===(null==r||null===(n=r.data)||void 0===n?void 0:n.length)||this.isSending)return!1;this.logId=t||"",this.isSending=!0,this.startTask(e,0)}},{key:"startTask",value:function(e){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this.readTypeStg(this.options.queue),o=i.data.filter((function(e){return!n.failIgnoreList.includes(n.identity(e))})).filter((function(t){return e||1!==t.pending})),a=o.shift();if(!(a&&Object.keys(a).length&&(a.body.length||Object.keys(a.body).length)&&this.isSending&&5>r))return this.stopTask();this.continueFailCount++;var s=Date.now(),c=this.getRequestData(a),u=c.head,f=l(c,zn);we("__VPN__")&&ce.error("埋点聚合",t({head:u},f));var d=kt(t({head:u},f));this.setItemStatus(c,1),qe(this.url+"?app_key=".concat(Wt.config.app_key,"&timestamp=").concat(s),t(t({},d),{},{method:"POST",timeout:Wt.config.fail_timeout,reTryCount:Wt.config.fail_retry_count,success:function(){n.success&&n.success(c),n.cleanDb(c),n.startTask(e,0)},fail:function(t,i){switch(t=t||"",+((i=i||999)||999)){case 442:case 435:n.cleanDb(c),n.logger.error(n.logId,"原因: ".concat(t,", code: ").concat(i," 处于[442, 435], 上报失败本地删除数据"),f);break;case 999:n.logger.error(n.logId,"原因: ".concat(t,", code: ").concat(i," 不处于[442, 435], 上报失败本地不删除数据"),f),n.setItemStatus(c,0),n.failIgnoreList.push(n.identity(c));break;default:(Me()||408!=i)&&n.logger.error(n.logId,"上报失败，原因: ".concat(t,", code: ").concat(i),f),n.setItemStatus(c,0)}n.startTask(e,++r)}}))}},{key:"stopTask",value:function(){return this.isSending=!1,this.continueFailCount=0,this.failIgnoreList=[],this.options.consumeEnd&&this.options.consumeEnd(),!1}},{key:"cleanDb",value:function(e){var t=this;this.writeTypeStgSafe(this.options.queue,(function(n){var r=n.filter((function(n){return t.identity(e)!==t.identity(n)}));return r.length!==n.length&&r}))}},{key:"setItemStatus",value:function(e){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.writeTypeStgSafe(this.options.queue,(function(i){var o=i.map((function(i){return n.identity(e)===n.identity(i)?t(t({},i),{},{pending:r}):i}));return o.length>0&&o}))}},{key:"sendBeacon",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.isSending=!0,this.startTask(e,t)}}]),i}(qn),Xn=["head"],Yn=function(e){s(i,e);var n=p(i);function i(){var e;return r(this,i),(e=n.call(this,{queue:T.BALANCE_REQ,identity:function(e){return e.request_id}})).logger=ce.clone({namespace:"对账上报",isShowLog:!0,isShowMills:!1}),e.url=Tt("$HOST/v3/balance/js/$APPID",Wt.uploadHost,Wt.config.app_id),e}return o(i,[{key:"getRequestData",value:function(e){return e.body.eventCompleteness=ge(e.body.eventCompleteness),t(t({},e),{},{head:this.reportHeader.getHeader(),custom_head:Wn.userInfo.getCustomHead()})}},{key:"success",value:function(e){var t=l(e,Xn);this.logger.debug("上报成功",Wt.config.is_print_header?e:t)}},{key:"report",value:function(){var e=this.readTypeStg(T.BALANCE),t=Object.keys(e.data).sort((function(e,t){return+e-+t}));if(0>=t.length)return!1;this.writeTypeStgMultiSafe([T.BALANCE,T.BALANCE_REQ],(function(e,t){if(!e||!Object.keys(e).length)return!1;var n={request_id:de(),body:{eventCompleteness:e}};return t.push(n),[{},t]})),this.consumeStart(!1)}}]),i}(Jn),Zn=["head"],er=function(e){s(i,e);var n=p(i);function i(){var e;r(this,i);var t=0,o=0;return(e=n.call(this,{queue:b.REQUEST,consumeEnd:function(){var n;(t&&(window.clearTimeout(t),t=0),"number"==typeof Wt.config.balance_stats_interval&&Wt.config.balance_stats_interval)?(o&&(window.clearTimeout(o),o=0),t=window.setTimeout((function(){e.writeTypeStg(b.TRACK_PENDING,{data:[],version:Date.now()})}),1e3*Wt.config.balance_stats_interval+2e3),o=window.setTimeout((function(){var t;null===(t=e.balanceReport)||void 0===t||t.report()}),1e3*Wt.config.balance_stats_interval)):(t=window.setTimeout((function(){e.writeTypeStg(b.TRACK_PENDING,{data:[],version:Date.now()})}),2e3),null===(n=e.balanceReport)||void 0===n||n.report())},identity:function(e){return e.request_id}})).balanceReport=void 0,e.url="",e.logger=ce.clone({namespace:"埋点上报",isShowLog:!0,isShowMills:!1}),e.url=Tt("$HOST/v3/track/js/$APPID",Wt.uploadHost,Wt.config.app_id),Wt.config.balance&&(e.balanceReport=new Yn),e}return o(i,[{key:"getRequestData",value:function(e){return t(t({},e),{},{head:this.reportHeader.getHeader(),custom_head:Wn.userInfo.getCustomHead()})}},{key:"success",value:function(e){l(e,Zn);this.logger.info("上报成功",e.body.map((function(e){return e.$sequence_id}))),Wn.userInfo.isFirstTime=!1,Wn.trackBalanceCreate.registerUpload(e.body,this.logId)}}]),i}(Jn),tr=["browser_type","browser_version"],nr=function(e,t,n){var r=function(e){var t={};return Object.keys(e).forEach((function(n){var r=0===n.indexOf("$")?n.replace("$",""):n;t[r]=e[n]})),t},i={head:l(r(e),tr),body:function(e){return Array.isArray(e)?e.map((function(e){return r(e)})):[r(e)]}(t),custom_head:r(n)};return i},rr=["properties"],ir=function(){return de(4,{letters:!1})},or=!1,ar=function(e){s(a,e);var i=p(a);function a(e){var n,o,s;r(this,a),(s=i.call(this)).durationEventMap={},s.batchSend=void 0,s.trackTimer=0,s.logId=ir(),s.consumeTrackCount=0,s.customPropertiesAttach=function(){return{}},s.headInfo=null===(n=new er)||void 0===n||null===(o=n.balanceReport)||void 0===o?void 0:o.reportHeader.getHeader(),s.browserInfo=function(){var e=navigator.userAgent.toLowerCase(),t=function(t){return t.test(e)},n=function(t){return(""+e.match(t)).replace(/[^0-9|_.]/g,"").replace(/_/g,".")},r="unknow";t(/windows|win32|win64|wow32|wow64/g)?r="windows":t(/macintosh|macintel/g)?r="macos":t(/x11/g)?r="linux":t(/android|adr/g)?r="android":t(/ios|iphone|ipad|ipod|iwatch/g)&&(r="ios");var i="unknow";"windows"===r?t(/windows nt 5.0|windows 2000/g)?i="2000":t(/windows nt 5.1|windows xp/g)?i="xp":t(/windows nt 5.2|windows 2003/g)?i="2003":t(/windows nt 6.0|windows vista/g)?i="vista":t(/windows nt 6.1|windows 7/g)?i="7":t(/windows nt 6.2|windows 8/g)?i="8":t(/windows nt 6.3|windows 8.1/g)?i="8.1":t(/windows nt 10.0|windows 10/g)&&(i="10"):"macos"===r?i=n(/os x [\d._]+/g):"android"===r?i=n(/android [\d._]+/g):"ios"===r&&(i=n(/os [\d._]+/g));var o="unknow";"windows"===r||"macos"===r||"linux"===r?o="desktop":("android"===r||"ios"===r||t(/mobile/g))&&(o="mobile");var a="unknow",s="unknow";t(/applewebkit/g)?(a="webkit",t(/edge/g)?s="edge":t(/opr/g)?s="opera":t(/chrome/g)?s="chrome":t(/safari/g)&&(s="safari")):t(/gecko/g)&&t(/firefox/g)?(a="gecko",s="firefox"):t(/presto/g)?(a="presto",s="opera"):t(/trident|compatible|msie/g)&&(a="trident",s="iexplore");var c="unknow";"webkit"===a?c=n(/applewebkit\/[\d._]+/g):"gecko"===a?c=n(/gecko\/[\d._]+/g):"presto"===a?c=n(/presto\/[\d._]+/g):"trident"===a&&(c=n(/trident\/[\d._]+/g));var u="unknow";"chrome"===s?u=n(/chrome\/[\d._]+/g):"safari"===s?u=n(/version\/[\d._]+/g):"firefox"===s?u=n(/firefox\/[\d._]+/g):"opera"===s?u=n(/opr\/[\d._]+/g):"iexplore"===s?u=n(/(msie [\d._]+)|(rv:[\d._]+)/g):"edge"===s&&(u=n(/edge\/[\d._]+/g));var l="none",f="unknow";return t(/micromessenger/g)?(l="wechat",f=n(/micromessenger\/[\d._]+/g)):t(/qqbrowser/g)?(l="qq",f=n(/qqbrowser\/[\d._]+/g)):t(/ucbrowser/g)?(l="uc",f=n(/ucbrowser\/[\d._]+/g)):t(/qihu 360se/g)?l="360":t(/2345explorer/g)?(l="2345",f=n(/2345explorer\/[\d._]+/g)):t(/metasr/g)?l="sougou":t(/lbbrowser/g)?l="liebao":t(/maxthon/g)&&(l="maxthon",f=n(/maxthon\/[\d._]+/g)),Object.assign({engine:a,engineVs:c,platform:o,supporter:s,supporterVs:u,system:r,systemVs:i},"none"===l?{}:{shell:l,shellVs:f})}(),s.oTrack=null,s.pickEventQToReqQThrottle=null,s.flush=Ae((function(){return!Wt.isReady()&&(!!Wt.config.flush&&void s.pickEventQToReqQ(2))}),2e3,{leading:!0});var c=t({},e);return void 0!==c.oTrack&&(s.oTrack=c.oTrack),Wt.registerCallbacks((function(e){var t,n,r,i=s.readTypeStg(b.DEFERRED);(s.batchSend=new er,e.app_version&&Wn.userInfo.setAppVersion(""+e.app_version||""),ce.info(e.app_id+" 当前环境: ".concat(e.env||"prod"),"设备ID: ".concat(null===(t=Wn.userInfo)||void 0===t?void 0:t.deviceId)),e.is_print_header)&&ce.info("公共头",null===(n=s.batchSend)||void 0===n||null===(r=n.balanceReport)||void 0===r?void 0:r.reportHeader.getHeader());i.data.length&&(s.readTypeStg(b.DEFERRED).data.forEach((function(e){var t,n=g(t=e)||m(t)||y(t)||w(),r=n[0],i=n.slice(1);-1!==["track"].indexOf(r)&&s[r].apply(f(s),i)})),s.writeTypeStgSafe(b.DEFERRED,(function(){return[]}))),s.pickEventQToReqQOriginal(3)})),or||(or=!0,G.addEvent(window,"beforeunload",(function(){var e;Me(!1),null===(e=s.batchSend)||void 0===e||e.sendBeacon(!0)})),G.addEvent(window,"unload",(function(){var e;Me(!1),null===(e=s.batchSend)||void 0===e||e.sendBeacon(!0)})),G.addEvent(window,"online",(function(){var e;null===(e=s.batchSend)||void 0===e||e.consumeStart(!0)}))),s}return o(a,[{key:"track",value:function(e,r){var i,o,a,s,c=arguments,u=Wt.config.pageview.url_alias,f=Wt.config.reported_platforms,d=Wt.config.quarantine_report,p={};if(this.logId=ir(),e.eventId)if(e.eventGroup)if(r&&"function"!=typeof r)ce.error("track方法回调函数参数非法");else{var v,g;if(e.properties=e.properties||{},void 0===e.properties.data_sequence_id&&(e.properties.data_sequence_id=this.oTrack.getDataSequenceId()),A.eventId!==e.eventId)p.$title=e.title||u[location.pathname||"/"]||document.title,p.$referrer=mt.getPrevUrl(),p.$referrer_host=(null===(v=$e(p.$referrer))||void 0===v?void 0:v.host)||"",p.$url=document.URL||document.documentURI||location.href||"",p.$url_path=location.pathname||"/"+p.$url.replace(/(#.*)/,"").split("/").slice(3).join("/");else p.$title=e.title,p.$referrer=e.referrer,p.$referrer_host=(null===(g=$e(p.$referrer))||void 0===g?void 0:g.host)||"",p.$url=e.url,p.$url_path=e.url_path;if(O.eventId===e.eventId?(p.$is_first_day=e.is_first_day,p.$is_first_time=e.is_first_time):this.oTrack.getAutoTrackParam&&(e.properties=t(t({},Le(this.oTrack.getAutoTrackParam()())),e.properties)),Wt.isReady()){var m=Wt.config,y=m.event_rule,_=m.event_blacklist,w=Vt(e,{event_rule:y,event_blacklist:_});if(w)ce.warn("事件被过滤",e);else{Wt.config.pageview.watch_utm&&(e.properties=t(t({},e.properties),this.oTrack.getUtm(e.properties))),e.properties=t(t(t({},t({},this.oTrack.store.getSessionProps())),e.properties),this.customPropertiesAttach());var k=Wt.config.on_track;if(k&&"function"==typeof k){var T=e.eventId,E=e.eventGroup,S=e.properties,I=l(e,rr);k.call(this.oTrack,{oTrack:this.oTrack,properties:S,context:I}),e.eventId=T,e.eventGroup=E}e.properties=t(t({},e.properties),{},{_track_id:Number((Ne()+"").slice(2,5)+(Ne()+"").slice(2,4)+((new Date).getTime()+"").slice(-4)),_flush_time:(new Date).getTime(),$item_id:(e.item_id||"")+"",$item_type:(e.item_type||"")+"",$project:Wt.config.project}),e.properties.$item_id&&e.properties.$item_type||(delete e.properties.$item_id,delete e.properties.$item_type);var C=t(t({},p),{},{$event_id:e.eventId,$event_group:e.eventGroup,$event_info:ge(e.properties),$event_time:0===e.eventId.indexOf("$")&&e.properties.$visit_time?e.properties.$visit_time:Date.now(),$sequence_id:Se()});if(ce.info(this.logId,"埋点产生",C,n(C)),d)this.pushTrackQueue(b.TRACK,C,r);else{var x=(null===(i=window)||void 0===i||null===(o=i.App_AutoEvent_Js_Bridge)||void 0===o?void 0:o.track)||(null===(a=window)||void 0===a||null===(s=a.App_Js_Bridge)||void 0===s?void 0:s.track);if(!f.includes("web")||x){var D=nr(this.headInfo,C,Wn.userInfo.getCustomHead());f.includes("app")&&x?0!==(null==C?void 0:C.$event_id.indexOf("$"))?window.App_Js_Bridge.track(JSON.stringify(D)):window.App_AutoEvent_Js_Bridge.track(JSON.stringify(D)):ce.info("未配置app上报或H5不在app中访问")}else this.pushTrackQueue(b.TRACK,C,r)}}}else this.writeTypeStgSafe(b.DEFERRED,(function(e){return e.push(["track"].concat(h([].slice.call(c)))),e}))}else ce.error("track方法事件模块必填");else ce.error("track方法eventId不能为空")}},{key:"startEvent",value:function(e,t){if(this.durationEventMap["".concat(e,"-").concat(t)])return ce.warn("event id: ".concat(e,", event group: ").concat(t," 已经start")),!1;ce.info("startEvent event id: ".concat(e,", event group: ").concat(t)),this.durationEventMap["".concat(e,"-").concat(t)]=(new Date).getTime()}},{key:"stopEvent",value:function(e,t,n){if(!this.durationEventMap["".concat(e,"-").concat(t)])return ce.warn("event id: ".concat(e,", event group: ").concat(t," 未开始")),!1;ce.info("Stop event id: ".concat(e,", event group: ").concat(t,", props: "),n),n.$duration=(new Date).getTime()-this.durationEventMap["".concat(e,"-").concat(t)],delete this.durationEventMap["".concat(e,"-").concat(t)],this.track({eventId:e,eventGroup:t,properties:n})}},{key:"pushTrackQueue",value:function(e,t,n){var r=this;if(-1===C.indexOf(e))return ce.warn(this.logId,"未知的事件类型 type: ".concat(e)),!1;Wn.trackBalanceCreate.registerCreate(t,this.logId);var i=this.writeTypeStgSafe(e,(function(e){return e.every((function(e){return e.$sequence_id!==t.$sequence_id}))&&e.push(t),e}));return Wt.config.fast?(this.pickEventQToReqQ(2),void(n&&n(this))):n?(this.pickEventQToReqQ(2),void n(this)):(Wt.config.max_batch_events>i.length||setTimeout((function(){r.pickEventQToReqQ(0),window.clearTimeout(r.trackTimer),r.trackTimer=0}),30*Math.random()),void(0===this.trackTimer&&(this.trackTimer=window.setTimeout((function(){r.pickEventQToReqQ(1),r.trackTimer=0}),1e3*Wt.config.interval_time))))}},{key:"pickEventQToReqQ",value:function(e){return this.pickEventQToReqQThrottle||(this.pickEventQToReqQThrottle=Ae(this.pickEventQToReqQOriginal.bind(this),100,{leading:!0})),this.pickEventQToReqQThrottle(e)}},{key:"pickEventQToReqQOriginal",value:function(e){var t,n=this,r=Wt.config.max_batch_events;4!==e&&(this.consumeTrackCount=0);this.writeTypeStgMultiSafe([b.TRACK,b.REQUEST],(function(e,t){if(!e||!e.length||t.length>=Wt.config.max_request_queue)return!1;var i=n.readTypeStg(b.TRACK_PENDING),o=e.slice(0,r).filter((function(e){return!i.data.includes(e.$sequence_id)}));n.writeTypeStgSafe(b.TRACK_PENDING,(function(e){return 0!==(null==o?void 0:o.length)&&(o.forEach((function(t){e.includes(t.$sequence_id)||e.push(t.$sequence_id)})),e.slice(-50))}));var a=e.filter((function(e){return o.every((function(t){return t.$sequence_id!==e.$sequence_id&&!i.data.includes(e.$sequence_id)}))}));if(o&&o.length>0){var s={request_id:de(),body:o};t.push(s)}return[a,t]}));for(var i=this.readTypeStg(b.TRACK);i.data.length>=Wt.config.max_batch_events&&1e3>this.consumeTrackCount;)this.consumeTrackCount++,this.pickEventQToReqQOriginal(4);null===(t=this.batchSend)||void 0===t||t.consumeStart(!1,this.logId)}},{key:"setCustomProperties",value:function(e){this.customPropertiesAttach="object"===n(e)?function(){return e}:e}}]),a}(qn),sr={url:"",url_path:"",title:"",referrer:"",event_info:null,_storeDuration:0,_lastViewTime:0},cr="prev_visit_page";!function(e){e[e.DURATION=0]="DURATION",e[e.PAGE_VIEW=1]="PAGE_VIEW"}(Qn||(Qn={}));var ur=function(){function e(n,i){var o=this;r(this,e),this.trackTime=!1,this.inactivityCounter=0,this.inactivityTime=15,this.getAutoTrackParams=null,this.pageDuration=sr,this.trackDispatch=void 0,this.logger=new se({namespace:"page_visit"}),this.oTrack=null,this.oTrack=i;var a=Wt.config;this.trackDispatch=n||function(){},this.pageDuration=t(t({},sr),Ee(cr)),this.pageDuration._lastViewTime>0&&this.toTrackQueue(Qn.DURATION,this.pageDuration,!0),this.startCounter(),"auto"===a.pageview.track_pageview_type.toLocaleLowerCase()&&a.is_single_page_app&&mt.push((function(e,t){t&&t.href===e.href||setTimeout((function(){o.trackPageView()}),a.pageview.delay)})),setTimeout((function(){o.trackPageView(a.pageview.is_trigger_pageload&&!a.pageview.track_ignore(location))}),a.pageview.delay),this.trackVersion(),this.trackPageLoad()}return o(e,[{key:"trackPageView",value:function(e,n){var r=t(t({},this.oTrack.detectSourceType()),n);void 0===e&&(e=!0),this.getAutoTrackParams&&H(this.getAutoTrackParams)&&(r=t(t({},Le(this.getAutoTrackParams())),r)),this.pageDuration&&this.toTrackQueue(Qn.DURATION,this.pageDuration,!1);var i=de(6),o=Date.now(),a={url:window.location.href||"/",url_path:window.location.pathname||"/",title:Wt.config.pageview.url_alias[location.pathname||"/"]||document.title,referrer:mt.getPrevUrl(),event_info:t(t({},r),{},{$visit_id:i,$visit_time:o}),_lastViewTime:Ie()};this.storeSession(a),!Wt.config.pageview.track_ignore(location)&&e&&this.toTrackQueue(Qn.PAGE_VIEW,t(t({},r),{},{$visit_id:i,$visit_time:o}))}},{key:"startCounter",value:function(){var e=this,t="hidden";this.startTime();var n=function(){document[t]?e.stopTime():e.startTime()};t in document?document.addEventListener("visibilitychange",n):(t="mozHidden")in document?document.addEventListener("mozvisibilitychange",n):(t="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",n):(t="msHidden")in document?document.addEventListener("msvisibilitychange",n):"onfocusin"in document?(G.addEvent(window,"focusin",(function(){e.startTime()})),G.addEvent(window,"focusout",(function(){e.stopTime()}))):(G.addEvent(window,"focus",(function(){e.startTime()})),G.addEvent(window,"blur",(function(){e.stopTime()})),G.addEvent(window,"pageshow",(function(){e.startTime()})),G.addEvent(window,"pagehide",(function(){e.stopTime()})));var r=function(){e.inactivityTime>e.inactivityCounter||e.startTime(),e.inactivityCounter=0};G.addEvent(window,"mousemove",r),G.addEvent(window,"click",r),G.addEvent(window,"keydown",r),G.addEvent(window,"scroll",r),G.addEvent(window,"beforeunload",(function(){e.stopTime()})),G.addEvent(window,"unload",(function(){e.stopTime()})),setInterval((function(){e.inactivityCounter++,e.inactivityTime>e.inactivityCounter||e.stopTime()}),6e4)}},{key:"startTime",value:function(){this.trackTime||(this.trackTime=!0,this.pageDuration._lastViewTime=Ie()-this.pageDuration._storeDuration,this.pageDuration._storeDuration=0,this.storeSession({_storeDuration:this.pageDuration._storeDuration,_lastViewTime:this.pageDuration._lastViewTime}))}},{key:"stopTime",value:function(){this.trackTime&&(this.trackTime=!1,this.pageDuration._storeDuration=Ie()-this.pageDuration._lastViewTime,this.storeSession({_storeDuration:this.pageDuration._storeDuration}))}},{key:"setAutoTrackParam",value:function(e){var t=e;"object"===n(e)&&(t=function(){return e}),this.getAutoTrackParams=t}},{key:"getAutoTrackParam",value:function(){return this.getAutoTrackParams||function(){return{}}}},{key:"toTrackQueue",value:function(e,r,i){if(e===Qn.DURATION){var o=0;if(i||this.trackTime?o=0!==this.pageDuration._storeDuration?this.pageDuration._storeDuration:Ie()-this.pageDuration._lastViewTime:this.trackTime||(o=this.pageDuration._storeDuration),o>0&&""!==this.pageDuration.url&&Wt.config.is_track_visittime){var a=r||{},s=a.event_info,c=a.url,u=a.url_path,l=a.title,f=a.referrer;this.trackDispatch(t(t({},A),{},{url:c,url_path:u,title:l,referrer:f,properties:t({duration:o},s)}))}return this.pageDuration=t({},sr),this.storeSession(null),!0}this.trackDispatch(t(t({},O),{},{properties:t({},"object"===n(r)?r:null),is_first_day:Wn.userInfo.isFirstDayFromCookies(),is_first_time:Wn.userInfo.isFirstTime}))}},{key:"storeSession",value:function(e){if(null==e)return Ee(cr,null);this.pageDuration=t(t(t({},sr),this.pageDuration),e),this.pageDuration.referrer||(this.pageDuration.referrer=mt.getPrevUrl()),Ee(cr,this.pageDuration)}},{key:"trackVersion",value:function(){var e=this,n=jt(Wt.config.region.toLowerCase(),Wt.config.env);qe("".concat(n,"/api/getVersion"),{success:function(n){var r;if((null===(r=Wt.getPkgInfo())||void 0===r?void 0:r.version)!==n.version){var i=window,o=i.performance||i.webkitPerformance||i.msPerformance||i.mozPerformance;if(o.getEntries&&"function"==typeof o.getEntries){var a=o.getEntries().find((function(e){return e.name.includes("/otrack/")}));if(a&&a.name){var s,c=a.toJSON()||{},u={url:window.location.href||"/",url_path:window.location.pathname||"/",title:Wt.config.pageview.url_alias[location.pathname||"/"]||document.title,referrer:mt.getPrevUrl(),properties:t({serverVersion:n.version,pkgVersion:null===(s=Wt.getPkgInfo())||void 0===s?void 0:s.version},c)};a&&e.trackDispatch(t(t({},$),u))}}}}})}},{key:"trackPageLoad",value:function(){var e,r=this,i=function e(){var i=window,o=i.performance||i.webkitPerformance||i.msPerformance||i.mozPerformance,a=0,s=0;if(o&&o.timing){var c=o.timing;0===c.fetchStart||0===c.domContentLoadedEventEnd?ce.error("performance 数据获取异常"):(a=Number(((a=c.domContentLoadedEventEnd-c.fetchStart)/1e3).toFixed(3)),o.getEntries&&"function"==typeof o.getEntries&&(o.getEntries().map((function(e){"transferSize"in e&&(s+=+e.transferSize)})),s=s>=0&&10737418240>s?Number((s/1024).toFixed(3)):-1))}else a=-1,ce.info("浏览器不支持 performance");var u={$page_event_duration:a,$page_resource_size:s};r.trackDispatch(t(t({},x),{},{properties:t({},"object"===n(u)?u:null)})),G.removeEvent(window,"load",e)};"complete"==(null===(e=document)||void 0===e?void 0:e.readyState)?i():G.addEvent(window,"load",i)}}]),e}(),lr="1.6.0",fr=function(){function e(n){r(this,e),this.oTrack=null,this.store=null,this.conf=null,this.autoTrackEnabled=!1,this.regexList={};var i=t({},n);this.oTrack=i.oTrack,this.store=i.store,this.conf=Wt.config,this.conf.preset_properties||(this.conf.preset_properties={latest_utm:!0,latest_referrer_host:!1,latest_landing_page:!1})}return o(e,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};ce.info("神策init初始化配置: ",e),void 0!==e.preset_properties&&(this.conf.preset_properties=t(t({},this.conf.preset_properties),e.preset_properties)),this.watchUTM(this.conf.preset_properties.latest_utm),void 0!==e.cross_subdomain&&(this.conf.is_cross_subdomain=e.cross_subdomain),void 0!==e.name&&(this.conf.namespace=e.name),void 0!==e.is_single_page&&(this.conf.is_single_page_app=e.is_single_page),void 0!==e.max_referrer_string_length&&(this.conf.max_referrer_string_length=e.max_referrer_string_length||200),e.debug_mode&&(this.conf.log_level="debug"),e.project&&(this.conf.project=e.project+""||"default")}},{key:"watchUTM",value:function(e){this.conf.pageview.watch_utm=!!e}},{key:"quick",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;t>r;r++)n[r-1]=arguments[r];return this[e].apply(this,n)}},{key:"autoTrackWithoutProfile",value:function(e){this.autoTrack(t(t({},e),{},{not_set_profile:!0}))}},{key:"autoTrack",value:function(e){this.autoTrackEnabled=!0,this.conf.pageview.is_trigger_pageload=!0;var t=!0;e&&(t=!e.not_set_profile,delete e.not_set_profile),this.sendFirstProfile(this.setOnceProfile.bind(this),!0,t),e&&this.oTrack.setCustomProperties(e)}},{key:"autoTrackSinglePage",value:function(e){this.conf.is_single_page_app=!0;var t=!0;e&&(t=!e.not_set_profile,delete e.not_set_profile),this.sendFirstProfile(this.setOnceProfile.bind(this),!1,t),this.oTrack.trackPageView(!0,e)}},{key:"isReady",value:function(e){"function"==typeof e&&Wt.registerCallbacks(e)}},{key:"trackHeatMap",value:function(e,t,n){this.oTrack.heatmap?this.oTrack.heatmap.trackHeatMap(e,t,n):ce.info("mini版jssdk不支持heatmap能力，若需要请使用完整版")}},{key:"trackAllHeatMap",value:function(e,t,n){this.oTrack.heatmap?this.oTrack.heatmap.trackAllHeatMap(e,t,n):ce.info("mini版jssdk不支持heatmap能力，若需要请使用完整版")}},{key:"getPresetProperties",value:function(){var e,n,r,i=this.oTrack.getHeader(),o=this.detectSourceType(!1),a=this.getUtm(o);return t(t({},i),{},{$url:(null===(e=window)||void 0===e?void 0:e.location.href)||"/",$url_path:(null===(n=window)||void 0===n?void 0:n.location.pathname)||"/",$title:null===(r=document)||void 0===r?void 0:r.title},a)}},{key:"getAnonymousID",value:function(){var e=this.store.getIdentities();return e.$identity_anonymous_id||e.$identity_login_id||""}},{key:"identify",value:function(e){if(this.autoTrackEnabled)throw Error("identify方法调用必须放在开启autoTrack之前");var t=e+"";t.length>0||ce.error("参数不能为空"),this.oTrack.setDeviceId(t),this.store.setIdentities({$identity_cookie_id:t})}},{key:"login",value:function(e,t){if(this.oTrack.getUserId())return ce.error("已经登录过，不可重复登录"),!1;var n=e+"";n.length>0||ce.error("参数不能为空"),this.trackSignup(n,"",{},t)}},{key:"logout",value:function(){var e=this.store.getIdentities().$identity_anonymous_id;this.oTrack.setUserId(""),this.store.setIdentities({$identity_login_id:e,$identity_anonymous_id:Se()})}},{key:"registerPage",value:function(e){this.oTrack.setAutoTrackParam((function(){return t({},e)}))}},{key:"clearPageRegister",value:function(e){if(q(e)){var t=this.oTrack.getAutoTrackParam()();e.forEach((function(e){e in t&&delete t[e]})),this.registerPage(t)}else!0===e&&this.oTrack.setAutoTrackParam({})}},{key:"register",value:function(e){this.store.setProps(e)}},{key:"registerOnce",value:function(e){this.store.setPropsOnce(e)}},{key:"clearAllRegister",value:function(e){this.store.clearAllProps(e)}},{key:"setProfile",value:function(e,n){var r=t(t({},P),{},{properties:e});r.eventId=r.eventId+"profile_set",this.oTrack.track(r,n)}},{key:"setOnceProfile",value:function(e,n){var r=t(t({},P),{},{properties:e});r.eventId=r.eventId+"profile_set_once",this.oTrack.track(r,n)}},{key:"sendFirstProfile",value:function(e,n,r){if(Wn.userInfo.isFirstTime&&r){var i=this.detectSourceType(!0),o=this.getUtm(i);e(t(t({},o),{},{$first_referrer:n?o.$first_referrer:o.$first_referrer.slice(0,this.conf.max_referrer_string_length)}))}}},{key:"getUtm",value:function(e){var t={};if(!this.conf.pageview.watch_utm)return t;if(!function(){var e,t,n=$e(null===(e=location)||void 0===e?void 0:e.href),r=$e(null===(t=document)||void 0===t?void 0:t.referrer);if(n&&r){var i=n.host.split("."),o=r.host.split("."),a=Math.min(i.length,o.length)-1;if(i.slice(-a).join(".")===o.slice(-a).join("."))return!0}return!1}()){if(j.utm.forEach((function(e){t["$"+e]=De(e)||""})),Wn.userInfo.isFirstTime&&t.$utm_source)return t.$source_type="utm",t.$first_traffic_source_type="付费广告流量",e.$latest_search_keyword&&(t.$first_search_keyword=e.$latest_search_keyword),t;j.utm.forEach((function(e){t["$latest_"+e]=De(e)||""})),t.$utm_source&&(t.$source_type="utm",t.$latest_traffic_source_type="付费广告流量")}return t}},{key:"detectSourceType",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n={},r=null===(e=window)||void 0===e?void 0:e.location;if(r){var i;n.$latest_referrer=(null===(i=document)||void 0===i?void 0:i.referrer)||"",n.$latest_traffic_source_type=n.$latest_referrer?"引荐流量":"直接流量",n.$latest_referrer_host="";var o=$e(n.$latest_referrer);o?(n.$latest_referrer="".concat(o.schema).concat(o.host).concat(o.path),n.$latest_referrer_host=o.host||"",n.$latest_search_keyword="未取到值"):n.$latest_search_keyword="未取到值_直接打开",this.conf.preset_properties.latest_landing_page&&(n.$latest_landing_page=r.href||"");for(var a=0;j.social.length>a;a++){var s=j.social[a],c=this.regexList[s];if(c||(c=this.regexList[s]=RegExp("\\b".concat(s,"\\b"),"i")),c.test(n.$latest_referrer_host)){n.$source_type="social",n.$latest_traffic_source_type="社交网站流量";break}}for(var u=0;j.search.length>u;u++){var l=j.search[u],f=this.regexList[l];if(f||(f=this.regexList[l]=RegExp("\\b".concat(l,"\\b"),"i")),f.test(n.$latest_referrer_host)){n.$source_type="search",n.$latest_traffic_source_type="自然搜索流量";for(var d=Object.keys(j.keyword),p=0;d.length>p;p++){var v=RegExp("\\b".concat(d[p],"\\b"),"i");if(v.test(l)){var h=j.keyword[d[p]];if(n.$latest_search_keyword="",o)for(var g=0;h.length>g&&(n.$latest_search_keyword=o.query[h[g]]||"",!n.$latest_search_keyword);g++);n.$latest_search_keyword||(n.$latest_search_keyword=n.$latest_referrer?"未取到值":"未取到值_直接打开");break}}break}}this.conf.preset_properties.latest_referrer_host||delete n.$latest_referrer_host}if(t&&Wn.userInfo.isFirstTime){var m,y;n.$first_visit_time=Date.now(),n.$first_referrer=(null===(m=document)||void 0===m?void 0:m.referrer)||"";var _=$e(n.$first_referrer);_&&(n.$first_referrer_host=_.host||"");var w=navigator||{};n.$first_browser_language=w.language||w.userLanguage||"",n.$first_browser_charset=(null===(y=document)||void 0===y?void 0:y.charset.toUpperCase())||""}return n}},{key:"unsetProfile",value:function(e,n){if("string"==typeof e)e=[e];else if(!q(e))return void ce.error("参数类型不合法");var r={};e.forEach((function(e){return r[e]=!0}));var i=t(t({},P),{},{properties:r});i.eventId=i.eventId+"profile_unset",this.oTrack.track(i,n)}},{key:"deleteProfile",value:function(e){var n=t({},P);n.eventId=n.eventId+"profile_delete",this.oTrack.track(n,e),this.oTrack.setUserId("")}},{key:"incrementProfile",value:function(e,n){"string"==typeof e&&(e=a({},e,1));var r={};Object.keys(e).forEach((function(t){return r[t]=Number(e[t])}));var i=t(t({},P),{},{properties:r});i.eventId=i.eventId+"profile_increment",this.oTrack.track(i,n)}},{key:"appendProfile",value:function(e,n){var r={},i=!0;if(Object.keys(e).forEach((function(t){r[t]="string"==typeof e[t]?[e[t]]:e[t],i=!1})),!i){var o=t(t({},P),{},{properties:r});o.eventId=o.eventId+"profile_append",this.oTrack.track(o,n)}}},{key:"track",value:function(e,n,r){var i=this.oTrack.tracker;if("string"!=typeof e)return i.track.apply(i,arguments);var o={},a=n||{};return o.eventId=a.eventId?a.eventId+"":e,o.eventGroup=a.eventGroup?a.eventGroup+"":"$track_sa",o.properties=t({},n),i.track.call(i,o,r)}},{key:"trackSignup",value:function(e,n,r,i){"string"!=typeof e&&(e+=""),this.oTrack.setUserId(e);var o=t(t({},r),{},{original_id:this.getAnonymousID(),distinct_id:e}),a=t(t({},P),{},{properties:o});a.eventId=a.eventId+(n||"signup"),this.oTrack.track(a,i);var s=this.store.getIdentities();this.store.setIdentities({$identity_login_id:e,$identity_anonymous_id:s.$identity_login_id})}},{key:"setItem",value:function(e,n,r){var i=t(t({},P),{},{item_type:e,item_id:n,properties:t({},r)});i.eventId=i.eventId+"item_set",this.oTrack.track(i)}},{key:"deleteItem",value:function(e,n){var r=t(t({},P),{},{item_type:e,item_id:n});r.eventId=r.eventId+"item_delete",this.oTrack.track(r)}},{key:"trackLink",value:function(e,t,n){this.oTrack.heatmap?this.oTrack.heatmap.trackLink(e,t,n):ce.info("mini版jssdk不支持heatmap能力，若需要请使用完整版")}},{key:"getAppStatus",value:function(){try{var e,t=(null===(e=window)||void 0===e?void 0:e.App_AutoEvent_Js_Bridge)||{},n=t.call_app&&t.call_app();if(n){var r=JSON.parse(n);r.is_login?(this.login(r.distinct_id),r.is_login_id=!0):r.is_login_id=!1,delete r.is_login,delete r.distinct_id,"Android"===r.type&&Wn.userInfo.setAppVersion(r.android_version);var i={};Object.keys(r).forEach((function(e){i["$".concat(e)]=r[e],"brand"===e&&(i.$manufacturer=r[e],delete i.$brand)}));try{var o,a=null===(o=navigator)||void 0===o?void 0:o.userAgent.match(/(\(.+?\))/);if(a){var s=a[0].match(/([\.\d\_\-]+)/)||[];i.$os_version=s[0]||""}}catch(e){i.$os_version=""}return i}}catch(e){console.error(e)}return{}}},{key:"uuid",value:function(){var e=Re();return e}},{key:"getDataSequenceId",value:function(){return"".concat(this.oTrack.getDeviceId(),"_").concat(Date.now())}},{key:"bind",value:function(){ce.info("bind方法暂未实现")}},{key:"unbind",value:function(){ce.info("unbind方法暂未实现")}},{key:"loginWithKey",value:function(){ce.info("loginWithKey方法暂未实现")}},{key:"use",value:function(e,t){ce.info("use方法暂未实现")}}]),e}(),dr="otrack_jssdk_session",pr=function(){function e(n){r(this,e),this.oTrack=null,this.state={props:{},identities:{$identity_cookie_id:"",$identity_anonymous_id:"",$identity_login_id:""},lib:{$lib:"js",$lib_method:"code",$lib_version:"1.24.6"}},this.sessionState={};var i=t({},n);void 0!==i.oTrack&&(this.oTrack=i.oTrack)}return o(e,[{key:"init",value:function(){this.initSessionState(),this.initState(),this.state.h5app=this.oTrack.getAppStatus();var e=t({},this.state.identities);if(!e.$identity_cookie_id){var n=this.oTrack.getDeviceId();n||(n=Se(),this.oTrack.setDeviceId(n)),e.$identity_cookie_id=n,e.$identity_anonymous_id=e.$identity_cookie_id,e.$identity_login_id=e.$identity_cookie_id}e.$identity_anonymous_id||(e.$identity_anonymous_id=Se()),e.$identity_login_id||(e.$identity_login_id=e.$identity_anonymous_id),this.state.identities=e,this.oTrack.setCustomHead(this.state)}},{key:"initState",value:function(){var e=this.oTrack.getCustomHead();this.state=t(t({},this.state),e)}},{key:"getIdentities",value:function(){return this.initState(),this.state.identities}},{key:"setIdentities",value:function(e){var n=1>=arguments.length||void 0===arguments[1]||arguments[1];this.initState(),this.state.identities=n?t(t({},this.state.identities),e):t(t({},e),this.state.identities),this.oTrack.setCustomHead(this.state)}},{key:"getProps",value:function(){return this.initState(),this.state.props}},{key:"setProps",value:function(e){var n=1>=arguments.length||void 0===arguments[1]||arguments[1];this.initState(),this.state.props=n?t(t({},this.state.props),e):t(t({},e),this.state.props),this.oTrack.setCustomHead(this.state)}},{key:"setPropsOnce",value:function(e){var t=this;this.initState(),Object.keys(e).forEach((function(n){n in t.state.props||(t.state.props[n]=e[n])})),this.oTrack.setCustomHead(this.state)}},{key:"initSessionState",value:function(){var e;try{e=me(wt(we(dr))||"null")}catch(e){ce.error("cookies otrack_jssdk_session 获取失败")}e&&(this.sessionState=e)}},{key:"sessionSave",value:function(){ye(dr,yt(ge(this.sessionState)),0,{cross_subdomain:Wt.config.is_cross_subdomain})}},{key:"getSessionProps",value:function(){return this.sessionState}},{key:"setSessionProps",value:function(e){this.sessionState=t(t({},this.sessionState),e),this.sessionSave()}},{key:"clearAllProps",value:function(e){var t=this;this.sessionState={},this.sessionSave(),e&&q(e)?e.forEach((function(e){e in t.state.props&&delete t.state.props[e]})):this.state.props={},this.oTrack.setCustomHead(this.state)}},{key:"getDistinctId",value:function(){return this.oTrack.getUserId()||this.oTrack.getDeviceId()}},{key:"getFirstId",value:function(){return this.oTrack.getDeviceId()}},{key:"getOriginDistinctId",value:function(){return this.oTrack.getUserId()||this.getIdentities().$identity_cookie_id}},{key:"getOriginUnionId",value:function(){var e={},t=this.getOriginDistinctId(),n=this.oTrack.getDeviceId();return t?(e.login_id=t,e.anonymous_id=n):e.anonymous_id=n,e}},{key:"getUnionId",value:function(){return this.getOriginUnionId()}}]),e}();new Promise((function(e){if(!(null==Array?void 0:Array.prototype.includes)||!(null==Object?void 0:Object.keys)){var t=document.createElement("script");t.onload=function(){e(!0)},document.head.appendChild(t),t.setAttribute("async","async"),t.setAttribute("src",_t("polyfill.umd.min.js"))}})),Wt.setPkgInfo({name:"@oplus/obus-track-sdk",version:lr});var vr=["track","startEvent","stopEvent","flush","setCustomProperties"],hr=["setCustomHead","getCustomHead","getDeviceId","setDeviceId","setAppVersion","getAppVersion","setUserId","getUserId","setCustomClientId","getCustomClientId","isFirstDayFromCookies","setIsWebview","getIsWebview"];function gr(e){var t=this;if(e){for(var n=e.split("."),r=n[n.length-1],i=0;n.length-1>i&&null!=(t=t[n[i]]);i++);if(null!=t){if(t&&"function"==typeof t[r]){for(var o=arguments.length,a=Array(o>1?o-1:0),s=1;o>s;s++)a[s-1]=arguments[s];return t[r].apply(t,a)}return t[r]}}else ce.error("".concat(e," 不能为空"))}var mr=function(){function e(t){var n=this;r(this,e),this.trackEvent=void 0,this.sensorsStore=void 0,this.dispatch=function(e){Wt.config.sdk_auto_track&&n.trackEvent.track(e)},Wt.init(t,this);var i=this.trackEvent=new ar({oTrack:this});hr.forEach((function(e){n[e]=function(){return gr.apply(Wn.userInfo,[e].concat(Array.prototype.slice.call(arguments)))}})),vr.forEach((function(e){n[e]=function(){return gr.apply(i,[e].concat(Array.prototype.slice.call(arguments)))}}));var o=this.sensorsStore=new pr({oTrack:this}),a=new fr({oTrack:this,store:o});Object.getOwnPropertyNames(fr.prototype).filter((function(e){return"constructor"!==e})).forEach((function(e){n[e]=function(){return gr.apply(a,[e].concat(Array.prototype.slice.call(arguments)))}})),this.getHeader=function(){return gr.apply(i,["batchSend.reportHeader.getHeader"].concat(Array.prototype.slice.call(arguments)))},this.updateCloudConfig=function(e){return gr.call(i,"cloudAppConfig.refresh",!0,(function(){(null==e||e)&&window.location.reload()}))};var s=new ur(this.dispatch,this);this.setAutoTrackParam=s.setAutoTrackParam.bind(s),this.getAutoTrackParam=s.getAutoTrackParam.bind(s),this.trackPageView=s.trackPageView.bind(s),this.sensorsStore.init(),"function"==typeof t.on_created&&t.on_created.call(this,{oTrack:this,options:t})}return o(e,[{key:"options",get:function(){return Wt.config}},{key:"store",get:function(){return this.sensorsStore}},{key:"tracker",get:function(){return this.trackEvent}}],[{key:"VERSION",get:function(){return lr}}]),e}();mr.CLOUD_VERSION=Rt.VERSION;var yr="data-exposure-id",_r=function(){function e(n){r(this,e),this.observeNodeList=[],this.options=void 0,this.observer=null,this.durationTimer={},this.options=Object.assign(t(t({},Wt.config.exposure),{},{dispatch:n})),1>=this.options.intersection_threshold&&this.options.intersection_threshold>0||(this.options.intersection_threshold=1),(this.options.duration_threshold>3e3||0>this.options.duration_threshold)&&(this.options.duration_threshold=0),this.init()}return o(e,[{key:"init",value:function(){var e=this;this.observer=new IntersectionObserver((function(t,n){t.forEach((function(t){var n=t.target,r=n.getAttribute(yr),i=e.observeNodeList.find((function(e){return e.el===n}));if(r&&i)if(t.isIntersecting&&t.intersectionRatio>=e.options.intersection_threshold){if(e.durationTimer[r]&&0!==e.durationTimer[r])return;e.durationTimer[r]=window.setTimeout((function(){var t=tt(!0,{properties:Pn(n)},i.data);e.options.dispatch(t),e.options.once?e.unobserve(n):e.clean(n)}),e.options.duration_threshold)}else e.durationTimer[r]&&e.clean(n)}))}),{root:null,rootMargin:this.options.root_margin,threshold:this.options.intersection_threshold})}},{key:"observe",value:function(e,t){e.getAttribute(yr)||e.setAttribute(yr,de(8)),this.observeNodeList.find((function(t){return t.el===e}))||(this.observeNodeList.push({el:e,data:t}),this.observer&&this.observer.observe(e))}},{key:"unobserve",value:function(e){var t;this.clean(e),this.observeNodeList=this.observeNodeList.filter((function(t){return t.el!==e})),null===(t=this.observer)||void 0===t||t.unobserve(e)}},{key:"clean",value:function(e){var t=e.getAttribute(yr);t&&(window.clearTimeout(this.durationTimer[t]),delete this.durationTimer[t])}}]),e}();!function(){if("object"!==("undefined"==typeof __wxConfig?"undefined":n(__wxConfig)))return new Promise((function(e){var t;if(!("IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in(null===(t=window)||void 0===t?void 0:t.IntersectionObserverEntry.prototype))){var n,r=null===(n=document)||void 0===n?void 0:n.createElement("script");r.onload=function(){e(!0)},document.head.appendChild(r),r.setAttribute("async","async"),r.setAttribute("src",_t("IntersectionObserver.min.js"))}}));console.log("wx",__wxConfig,"__wxConfig 在index.ts")}();var wr=function(e){s(i,e);var n=p(i);function i(e){var o;r(this,i);var a,s,c,u=(o=n.call(this,e)).dispatch,l=new _r(u);return o.exposure={observe:l.observe.bind(l),unobserve:l.unobserve.bind(l)},Rn({logger:ce.clone({namespace:"heatmap"}),heatmap:Wt.config.heatmap,dispatch:u}),o.heatmap={trackHeatMap:Ln.trackHeatMap.bind(Ln),trackAllHeatMap:Ln.trackAllHeatMap.bind(Ln),trackLink:Ln.trackLink.bind(Ln)},Sn(u),a=function(e){u(t(t({},D),{},{properties:t(t({},e),{},{msg:"string"==typeof e.msg?e.msg.slice(0,Wt.config.develop.errorSplit):e.msg})}))},s=function(){return{catch_js_error:Wt.config.develop.catch_js_error,errorRatio:Wt.config.develop.errorRatio}},c=window.onerror,window.onerror=function(e,t,n,r,i){if(!s().catch_js_error)return!1;var o=0>s().errorRatio||s().errorRatio>1?.2:s().errorRatio;if(qt){if(1>(Date.now()-qt)/6e4){if(Math.random()-o>o)return;qt=Date.now()}}else qt=Date.now();var u=e;i&&i.stack&&(u=Qt(i)),a({msg:u,target:t,rowNum:n,colNum:r,orgMsg:e,level:4}),c&&c.apply(window,arguments)},window.addEventListener("unhandledrejection",(function(e){if(e.preventDefault(),!s().catch_js_error)return!1;var t=e.reason;if(e&&e.reason&&"Object"===F(e.reason))try{t=JSON.stringify(e.reason),console.error(t)}catch(e){console.error("[oReport] stringify error"),console.error(e)}a({msg:t||"unhandledrejection",target:"unhandledrejection",rowNum:0,colNum:0,level:4})})),o.getEleDetail=Pn,o}return o(i)}(mr);return wr}));
